<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 13:34:52 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>grim_colortool.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="grim_colortool.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;=============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	GRIM_COLORTOOL</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Tool for adjusting colors in GRIM.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;	NV/GRIM</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	</span>
<span class="comments">;	grim_colortool</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; ARGUMENTS: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; OPERATION:</span>
<span class="comments">;	Color table plot:</span>
<span class="comments">;		Displays a plot of the current color table, with a color</span>
<span class="comments">;		bar at the bottom.</span>
<span class="comments">;</span>
<span class="comments">;	Stretch Top slider:</span>
<span class="comments">;		Controls the top value for the color table stretch.</span>
<span class="comments">;</span>
<span class="comments">;	Stretch Bottom slider:</span>
<span class="comments">;		Controls the bottom value for the color table stretch.</span>
<span class="comments">;</span>
<span class="comments">;	Gamma slider:</span>
<span class="comments">;		Controls the gamma value for the color table stretch.</span>
<span class="comments">;</span>
<span class="comments">;	Shade slider:</span>
<span class="comments">;		Vertial slider on the left side of the tool controlling the </span>
<span class="comments">;		total brightness.</span>
<span class="comments">;</span>
<span class="comments">;	Color table droplist:</span>
<span class="comments">;		Selects IDL color table.</span>
<span class="comments">;</span>
<span class="comments">;	Auto button:</span>
<span class="comments">;		Performs an automatic stretch.</span>
<span class="comments">;</span>
<span class="comments">;	All button:</span>
<span class="comments">;		If set (or activated), the current color table is applied</span>
<span class="comments">;		to all GRIM planes.  If 'Auto' is pressed while 'All' is</span>
<span class="comments">;		on, the automatic stretch is performed independently for</span>
<span class="comments">;		each plane.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; SEE ALSO:</span>
<span class="comments">;	grim</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">; 	Written by:	Spitale </span>
<span class="comments">;	</span>
<span class="comments">;-</span>
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_slider_to_gamma</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_slider_to_gamma:source"></a>function grct_slider_to_gamma, value
 return, 10d^(value/25d - 2d)
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_gamma_to_slider</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_gamma_to_slider:source"></a>function grct_gamma_to_slider, value
 return, 25d*(alog10(value) + 2d)
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_print_gamma</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_print_gamma:source"></a>pro grct_print_gamma, data
  
 widget_control, data.gamma_slider, get_value = value
 widget_control, data.gamma_label, $
                set_value = str_pad(strtrim(grct_slider_to_gamma(value), 2), 7)

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_widget_to_descriptor</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_widget_to_descriptor:source"></a>function grct_widget_to_descriptor, data, cmd

 ctmod, top=top
 n_colors = cmd.n_colors

 widget_control, data.bottom_slider, get_value = value 
 cmd.bottom = value/100d * n_colors
 widget_control, data.top_slider, get_value = value
 cmd.top = value/100d * n_colors

 widget_control, data.gamma_slider, get_value = value
 cmd.gamma = grct_slider_to_gamma(value)

 widget_control, data.shade_slider, get_value = value
 cmd.shade = value/100d

 return, cmd
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_descriptor_to_widget</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_descriptor_to_widget:source"></a>pro grct_descriptor_to_widget, data, cmd, noslide=noslide

 n_colors = cmd.n_colors
 noslide = keyword_set(noslide)

 if(NOT noslide) then $
        widget_control, data.bottom_slider, set_value = cmd.bottom*100d/n_colors
 if(NOT noslide) then $
        widget_control, data.top_slider, set_value = cmd.top*100d/n_colors

 if(NOT noslide) then widget_control, data.gamma_slider,$
                        set_value = grct_gamma_to_slider(cmd.gamma) 

 if(NOT noslide) then $
        widget_control, data.shade_slider, set_value = cmd.shade*100d


 ctmod, top=top, visual=visual

 widget_control, data.base, $
                   tlb_set_title='Grim color tool : ' + grim_title(/primary)
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_plot</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_plot:source"></a>pro grct_plot, data

 grim_data = grim_get_data(/primary)
 plane = grim_get_plane(grim_data)

 n_colors = plane.cmd.n_colors

 wset, data.wnum
 colormap = compute_colormap(plane.cmd)
 colormap = congrid(colormap, 100) * 255 / n_colors

 ctmod, top=top, visual=visual

 erase, ctblack()
 plot, colormap, xstyle=1, ystyle=1, pos=[0.12,0.2, 0.95,0.95], th=2, $
       col=ctwhite()



 p = convert_coord(0d,0d, /data, /to_device)
 pp = convert_coord(100d,0d, /data, /to_device)

 xs = pp[0] - p[0]

 bar = long(findgen(xs) * float(100) / float(xs))

 yy = 15

 cbar = bar # make_array(yy, val=1)

 if((visual EQ 8)) then $
  begin 
   colorbar = apply_colormap(cbar, colormap)
   tv, colorbar, p[0], 0
  end $
 else $
  begin
   red = apply_colormap(cbar, colormap, channel=0)
   grn = apply_colormap(cbar, colormap, channel=1)
   blu = apply_colormap(cbar, colormap, channel=2)
   tv, red, channel=1, p[0], 0
   tv, grn, channel=2, p[0], 0
   tv, blu, channel=3, p[0], 0
  end


 plots, [p[0], p[0], pp[0]-1, pp[0]-1, p[0]], [0, yy, yy, 0, 0], /device


end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_cleanup</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_cleanup:source"></a>pro grct_cleanup, base

 widget_control, base, get_uvalue=data
 grim_rm_primary_callback, data.data_p

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_update</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_update:source"></a>pro grct_update, cmd, all=all, auto=auto

 grim_data = grim_get_data(/primary)
 if(NOT keyword_set(grim_data)) then return

 ctmod, visual=visual

 <span class="comments">;--------------------------------------</span>
 <span class="comments">; detect color table change</span>
 <span class="comments">;--------------------------------------</span>
 tvlct, r, g, b, /get
 w = where([r, g, b] - $
           [*grim_data.tv_rp, *grim_data.tv_gp, *grim_data.tv_bp] NE 0)
 if((w[0] NE -1) AND (visual NE 24)) then $
  begin
   *grim_data.tv_rp = r
   *grim_data.tv_gp = g
   *grim_data.tv_bp = b
   return
  end

 <span class="comments">;--------------------------------------</span>
 <span class="comments">; update cmd</span>
 <span class="comments">;--------------------------------------</span>
 planes = grim_get_plane(grim_data, all=all)
 n = n_elements(planes)

 if(keyword_set(auto)) then grim_stretch_plane, grim_data, planes $
 else $
  for i=0, n-1 do $
   begin
    planes[i].cmd = cmd
    grim_set_plane, grim_data, planes[i], pn=planes[i].pn
   end

 grim_set_data, grim_data, grim_data.base
 grim_refresh, grim_data, /no_erase
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_colortool_event</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_colortool_event:source"></a>pro grim_colortool_event, event

 grim_data = grim_get_data(/primary)
 plane = grim_get_plane(grim_data)

 widget_control, event.top, get_uvalue=data, /hourglass

 struct = tag_names(event, /struct)
 update = 0
 auto = 0

 all = widget_info(data.all_button, /button_set)

 cmd = grct_widget_to_descriptor(data, plane.cmd)


 <span class="comments">;---------------------------</span>
 <span class="comments">; 'All' button</span>
 <span class="comments">;---------------------------</span>
 if(event.id EQ data.all_button) then update = 1 $

 <span class="comments">;---------------------------</span>
 <span class="comments">; 'Auto' button</span>
 <span class="comments">;---------------------------</span>
 else if(event.id EQ data.auto_button) then $
  begin
   auto = 1
   update = 1
  end $

 <span class="comments">;---------------------------</span>
 <span class="comments">; 'Done' button</span>
 <span class="comments">;---------------------------</span>
 else if(event.id EQ data.done_button) then $
  begin
   widget_control, data.base, /destroy
   return
  end $

 <span class="comments">;---------------------------</span>
 <span class="comments">; table droplist</span>
 <span class="comments">;---------------------------</span>
 else if(event.id EQ data.ct_droplist) then $
  begin
   loadct, event.index, /silent
   ctmod, top=top, visual=visual
   update = 1
  end $

 <span class="comments">;---------------------------</span>
 <span class="comments">; draw widget</span>
 <span class="comments">;---------------------------</span>
 else if(event.id EQ data.graph) then $
  begin
   device, cursor_standard = 34
  end $

 <span class="comments">;---------------------------</span>
 <span class="comments">; other widgets</span>
 <span class="comments">;---------------------------</span>
 else $
  begin
   grct_plot, data

   if(event.id EQ data.gamma_slider) then grct_print_gamma, data

   if(struct NE 'WIDGET_SLIDER') then update = 1 $
   else if(NOT event.drag) then update = 1
  end


 <span class="comments">;-------------------------------------</span>
 <span class="comments">; update color table</span>
 <span class="comments">;-------------------------------------</span>
 if(update) then grct_update, cmd, all=all, auto=auto


 widget_control, event.top, set_uvalue=data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_colortool_change</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_colortool_change:source"></a>pro grim_colortool_change, base

 grim_data = grim_get_data(/primary)
 plane = grim_get_plane(grim_data)

 widget_control, base, get_uvalue=data

 grct_descriptor_to_widget, data, plane.cmd
 grct_plot, data
 grct_print_gamma, data

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grct_primary_notify</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grct_primary_notify:source"></a>pro grct_primary_notify, data_p

 grim_data = grim_get_data(/primary)
 plane = grim_get_plane(grim_data)

 if(grim_data.type EQ 'plot') then return

 grim_colortool_change, (*data_p).base

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_colortool</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_colortool:source"></a>pro grim_colortool
common grim_colortool_block, base

 grim_data = grim_get_data(/primary)
 plane = grim_get_plane(grim_data)

 if(xregistered('grim_colortool')) then $
  begin
   grim_colortool_change, base
   return
  end


 <span class="comments">;-------------------------------------------------------------------</span>
 <span class="comments">; get color table names and values</span>
 <span class="comments">;-------------------------------------------------------------------</span>
 loadct, get_names=ct_list
 

 <span class="comments">;--------------------------------------------</span>
 <span class="comments">; widgets</span>
 <span class="comments">;--------------------------------------------</span>
 base = widget_base(/col)

 fns = ['Linear', 'Exponential', 'Log']

 col_base = widget_base(base, /col)
 dl_base = widget_base(col_base, /row)
 all_base = widget_base(dl_base, /nonexclusive, /frame)
 all_button = widget_button(all_base, value=' All')
 auto_button = widget_button(dl_base, value='Auto')
 ct_droplist = widget_droplist(dl_base, value=ct_list, title='Color Table:')
 row_base = widget_base(col_base, /row, /frame)


 shade_slider = widget_slider(row_base, ysize=180, /drag, max=100, /vertical, /supp)
 graph = widget_draw(row_base, xsize=220, ysize=180, /tracking, retain=2)
 slider_base = widget_base(row_base, /col, xsize=200)
 top_slider = $
          widget_slider(slider_base, title='Stretch top', xsize=200, $
                                                             max=100, /drag)

 bottom_slider = $
     widget_slider(slider_base, title='Stretch bottom', xsize=200, $
                                                             max=100, /drag)

 gamma_label = widget_label(slider_base, value='---------', /align_center)
 gamma_slider = $
            widget_slider(slider_base, title='Gamma', $
                                               xsize=200, /drag, /suppress)

 done_button = widget_button(base, value='Done')





 <span class="comments">;-----------------------------------------------------</span>
 <span class="comments">; realize and register</span>
 <span class="comments">;-----------------------------------------------------</span>
 widget_control, base, /realize
 xmanager, 'grim_colortool', base, /no_block, cleanup='grct_cleanup'


 widget_control, graph, get_value=wnum


 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; main data structure</span>
 <span class="comments">;-----------------------------------------------</span>
 data = { $
		<span class="comments">;-------------------</span>
 		<span class="comments">; widgets</span>
		<span class="comments">;-------------------</span>
		base		:	base, $
		ct_droplist	:	ct_droplist, $
		all_button	:	all_button, $
		auto_button	:	auto_button, $
		graph		:	graph, $
		top_slider	:	top_slider, $
		bottom_slider	:	bottom_slider, $
		gamma_slider	:	gamma_slider, $
		gamma_label	:	gamma_label, $
		shade_slider	:	shade_slider, $
		done_button	:	done_button, $
		wnum		:	wnum, $

		<span class="comments">;-------------------</span>
 		<span class="comments">; book-keeping</span>
		<span class="comments">;-------------------</span>
		data_p		:	nv_ptr_new() $
	     }

 data.data_p = nv_ptr_new(data)

 widget_control, base, set_uvalue = data

 grct_descriptor_to_widget, data, plane.cmd
 grct_plot, data

 grim_add_primary_callback, 'grct_primary_notify', data.data_p
 grct_print_gamma, data

end
<span class="comments">;=============================================================================</span>
</code>
    </div>
  </body>
</html>