<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Thu Jul 20 11:02:50 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>grim_data_include.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="grim_data_include.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;=============================================================================</span>
<span class="comments">; grim_blank</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_blank:source"></a>function grim_blank, xsize, ysize
 return, bytarr(xsize, ysize)
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_init</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_init:source"></a>function grim_init, dd, dd0=dd0, zoom=zoom, wnum=wnum, grnum=grnum, filter=filter,$
           retain=retain, user_callbacks=user_callbacks, $
           user_psym=user_psym, user_graphics_fn=user_graphics_fn, user_thick=user_thick, user_line=user_line, $
           cursor_swap=cursor_swap, cmd=cmd, $
           path=path, save_path=save_path, load_path=load_path, fov=fov, clip=clip, $
           cam_trs=cam_trs, plt_trs=plt_trs, rng_trs=rng_trs, str_trs=str_trs, stn_trs=stn_trs, arr_trs=arr_trs, $
           sun_trs=sun_trs, hide=hide, type=type, $
	   cam_select=cam_select, plt_select=plt_select, rng_select=rng_select, $
	   sun_select=sun_select, str_select=str_select, stn_select=stn_select, arr_select=arr_select, $
           color=color, xrange=xrange, yrange=yrange, position=position, npoints=npoints, $
           thick=thick, nsum=nsum, xtitle=xtitle, ytitle=ytitle, $
           psym=psym, cursor_modes=cursor_modes, $
           symsize=symsize, nhist=nhist, maintain=maintain, workdir=workdir, $
           compress=compress, extensions=extensions, max=max, beta=beta, $
           visibility=visibility, channel=channel, title=title, slave_overlays=slave_overlays, $
           render_sample=render_sample, render_pht_min=render_pht_min, $
           overlays=overlays, activate=activate
@grim_block.include

  if(NOT keyword_set(dd0)) then dd0 = obj_new()
  if(NOT keyword_set(nhist)) then nhist = 1

  beta = keyword_set(beta)
  activate = keyword_set(activate)

  if(NOT keyword_set(user_psym)) then user_psym = 3
  if(NOT keyword_set(user_graphics_fn)) then user_graphics_fn = 3
  if(NOT keyword_set(user_thick)) then user_thick = 1
  if(NOT keyword_set(user_line)) then user_line = 0
  if(NOT keyword_set(slave_overlays)) then slave_overlays = 0
  if(NOT defined(cursor_swap)) then cursor_swap = -1
  if(NOT keyword_set(overlays)) then overlays = ''

  if(NOT keyword_set(cursor_modes)) then cursor_modes_p = ptr_new(0) $
  else cursor_modes_p = ptr_new(cursor_modes)

  if(NOT keyword_set(npoints)) then npoints = 0
  if(NOT keyword_set(fov)) then fov = 0.
  if(NOT keyword_set(clip)) then clip = 0.
  if(NOT keyword_set(filter)) then filter = ''

  if(keyword_set(path)) then load_path = (save_path = path)
  if(NOT keyword_set(load_path)) then load_path = ''
  if(NOT keyword_set(save_path)) then save_path = ''
  if(NOT keyword_set(workdir)) then workdir = './'

  if(NOT keyword_set(cam_select)) then cam_select = ''
  if(NOT keyword_set(plt_select)) then plt_select = ''
  if(NOT keyword_set(rng_select)) then rng_select = ''
  if(NOT keyword_set(str_select)) then str_select = ''
  if(NOT keyword_set(stn_select)) then stn_select = ''
  if(NOT keyword_set(arr_select)) then arr_select = ''
  if(NOT keyword_set(sun_select)) then sun_select = ''

  if(NOT keyword_set(cam_trs)) then cam_trs = ''
  if(NOT keyword_set(plt_trs)) then plt_trs = ''
  if(NOT keyword_set(rng_trs)) then rng_trs = ''
  if(NOT keyword_set(str_trs)) then str_trs = ''
  if(NOT keyword_set(stn_trs)) then stn_trs = ''
  if(NOT keyword_set(arr_trs)) then arr_trs = ''
  if(NOT keyword_set(sun_trs)) then sun_trs = ''

  if(NOT keyword_set(color)) then color = ctwhite()
  if(NOT keyword_set(thick)) then thick = 1
  if(NOT keyword_set(nsum)) then nsum = 0
  if(NOT keyword_set(psym)) then psym = -3l
  if(NOT keyword_set(symsize)) then symsize = 1.
 
  if(NOT keyword_set(title)) then title = ''
  if(NOT keyword_set(xtitle)) then xtitle = ''
  if(NOT keyword_set(ytitle)) then ytitle = ''

  <span class="comments">;----------------------</span>
  <span class="comments">; main data structure</span>
  <span class="comments">;----------------------</span>
<span class="comments">;  grim_data = {grim_data_struct, $</span>
  grim_data = { $
	<span class="comments">;---------------</span>
	<span class="comments">; widgets</span>
	<span class="comments">;---------------</span>
		base			: 0l, $
		shortcuts_base		: 0l, $
		shortcuts_base1		: 0l, $
		shortcuts_base2		: 0l, $
		shortcuts_base3		: 0l, $
		shortcuts_base4		: 0l, $
		shortcuts_base5		: 0l, $
		shortcuts_base6		: 0l, $
		shortcuts_base7		: 0l, $
		shortcuts_base8		: 0l, $
		shortcuts_base9		: 0l, $
		color_button		: 0l, $
		settings_button		: 0l, $
		crop_button		: 0l, $
		next_button		: 0l, $
		previous_button		: 0l, $
		jumpto_text		: 0l, $
		refresh_button		: 0l, $
		hide_button		: 0l, $
		toggle_image_button	: 0l, $
		toggle_image_overlays_button	: 0l, $
		entire_button		: 0l, $
		view_previous_button	: 0l, $
		tracking_button		: 0l, $
		render_button		: 0l, $
		undo_button		: 0l, $
		redo_button		: 0l, $
		undo_menu_id		: 0l, $
		redo_menu_id		: 0l, $
		activate_all_button	: 0l, $
		deactivate_all_button	: 0l, $
		guideline_button	: 0l, $
		identify_button		: 0l, $
		pixel_grid_button	: 0l, $
		grid_button		: 0l, $
		remove_xd_button	: 0l, $
		axes_button		: 0l, $
		header_button		: 0l, $
		notes_button		: 0l, $
		repeat_button		: 0l, $
		sub_base		: 0l, $
		modes_base		: 0l, $
		select_button		: 0l, $
		context_button		: 0l, $
		footprint_button	: 0l, $
		mbar			: 0l, $
		menu			: 0l, $
		help_menu		: 0l, $
		draw_base		: 0l, $
		draw			: 0l, $
		context_draw		: 0l, $
		context_base		: 0l, $
		axes_draw		: 0l, $
		axes_base		: 0l, $
		message_base		: 0l, $
		xy_label		: 0l, $
		label			: 0l, $
		menu_ids_p		: ptr_new(), $
		menu_desc_p		: ptr_new(), $
		map_items_p		: ptr_new(), $
		od_map_items_p		: ptr_new(), $
		readout_top		: 0l, $
		readout_text		: 0l, $
		header_text		: -1l, $
		header_base		: -1l, $
		notes_text		: -1l, $
		notes_base		: -1l, $
		help_text		: -1l, $
		help_base		: -1l, $
	<span class="comments">;---------------</span>
	<span class="comments">; bookkeeping</span>
	<span class="comments">;---------------</span>
		base_xsize		: 0l, $
		base_ysize		: 0l, $

		activate		: activate, $
		beta			: beta, $
		npoints			: npoints, $
		nhist			: nhist, $
		ref_comb		: 'Average', $
		type			: type, $	<span class="comments">; 'image', 'plot', 'map'</span>
		user_tlp		: ptr_new(), $
		retain			: retain, $
		maintain		: maintain, $
		compress		: compress, $
		extensions		: extensions, $
		cursor_swap		: cursor_swap, $
		zoom			: zoom, $
		mode			: '', $
		mode_data_p		: ptr_new(0), $
		grid_flag		: 0, $
		pixel_grid_flag		: 0, $
		guideline_flag		: 0, $
		guideline_pixmaps	: [0l,0l], $
		guideline_save_xy	: [-1d,-1d], $
		axes_flag		: 0, $
		readout_mark		: dblarr(2), $
		measure_mark		: dblarr(2,2), $
		selected		: 0, $
		scale_wnum		: 0, $
		wnum			: 0, $
		pixmap			: -1, $
		redraw_pixmap		: -1, $
		overlay_pixmap		: -1, $
		context_wnum		: 0, $
		context_pixmap		: 0, $
		context_mapped		: 0, $
		axes_wnum		: 0, $
		mag_redraw_pixmap	: 0, $
		mag_pixmap		: 0, $
		mag_last_x0		: -1l, $
		mag_last_y0		: -1l, $
		grnum			: -1l, $
		act_callbacks_p		: ptr_new(''), $
		act_callbacks_data_pp	: ptr_new(0), $
		rf_callbacks_p		: ptr_new(''), $
		rf_callbacks_data_pp	: ptr_new(0), $
		pn_callbacks_p		: ptr_new(''), $
		pn_callbacks_data_pp	: ptr_new(0), $
		tv_rp			: ptr_new(0), $
		tv_gp			: ptr_new(0), $
		tv_bp			: ptr_new(0), $
		hidden			: 0, $		<span class="comments">; all overlays hidden?</span>
		tracking		: 1, $		
		min_p			: ptr_new(0), $
		max_p			: ptr_new(0), $
		default_user_graphics_fn	: user_graphics_fn, $
		default_user_psym	: user_psym, $
		default_user_thick	: user_thick, $
		default_user_line	: user_line, $
		repeat_fn		: '', $
		repeat_event_p		: ptr_new(0), $ 
		cursor_modes_p		: cursor_modes_p, $
		workdir			: workdir, $
		tvd_init_p		: ptr_new(0), $
		dd_map_p		: ptr_new(0), $
		md_map_p		: ptr_new(0), $
		dd0			: dd0, $
		data_xy_p		: ptr_new(0), $		<span class="comments">; data coords of viewport indices</span>

		slave_overlays		: slave_overlays, $

		misc_data_p		: ptr_new(0), $

		cam_select     		: cam_select, $
		plt_select     		: plt_select, $
		rng_select     		: rng_select, $
		str_select     		: str_select, $
		stn_select     		: stn_select, $
		arr_select     		: arr_select, $
		sun_select     		: sun_select, $

	<span class="comments">;---------------</span>
	<span class="comments">; planes</span>
	<span class="comments">;---------------</span>
		n_planes	: 0, $			<span class="comments">; # of image planes</span>
							<span class="comments">;  active + inactive</span>
		planes_p	: ptr_new(0), $		<span class="comments">; Image planes</span>
		pl_flags_p	: ptr_new(0), $		<span class="comments">; Plane flags</span>
							<span class="comments">;  0 - inactive</span>
							<span class="comments">;  1 - active</span>
							<span class="comments">;  2 - blank</span>
		pn		: 0, $			<span class="comments">; current plane number</span>

		def_cam_trs	: cam_trs, $
		def_plt_trs	: plt_trs, $
		def_rng_trs	: rng_trs, $
		def_str_trs	: str_trs, $
		def_stn_trs	: stn_trs, $
		def_arr_trs	: arr_trs, $
		def_sun_trs	: sun_trs, $

		def_load_path	: load_path, $
		def_save_path	: save_path, $
		def_filter	: filter, $

		def_fov		: fov, $
		def_clip	: clip, $
		def_hide	: hide, $

		def_color	: color[0], $
		def_psym	: psym[0], $
		def_symsize	: symsize[0], $
		def_thick	: thick[0], $
		def_nsum	: nsum[0], $

		def_title	: title[0], $
		def_xtitle	: xtitle[0], $
		def_ytitle	: ytitle[0] $
	     }

  <span class="comments">;---------------------</span>
  <span class="comments">; planes</span>
  <span class="comments">;---------------------</span>
  grim_add_planes, grim_data, dd, $
     xrange=xrange, yrange=yrange, position=position, xtitle=xtitle, ytitle=ytitle, max=max, $
                    color=color, thick=thick, visibility=visibility, channel=channel, $
                       render_sample=render_sample, render_pht_min=render_pht_min, $
                          overlays=overlays, cmd=cmd

 <span class="comments">;----------------------</span>
 <span class="comments">; common block</span>
 <span class="comments">;----------------------</span>
 if(n_elements(_selected) EQ 0) then _selected = -1

 return, grim_data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_exists</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_exists:source"></a>function grim_exists, grim_data
 if(NOT keyword_set(grim_data)) then return, 0
 return, ptr_valid(grim_data.planes_p)
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_grnum_to_top</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_grnum_to_top:source"></a>function grim_grnum_to_top, grnum
common grnum_block, tops
 return, tops[grnum]
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_get_data</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_get_data:source"></a>function grim_get_data, top, grnum=grnum, plane=plane, $
         dead=dead, primary=primary, no_wset=no_wset
@grim_block.include

 if(keyword_set(plane)) then grnum = plane.grnum

 if(defined(grnum)) then top = grim_grnum_to_top(grnum)
 if((NOT keyword_set(top)) AND (NOT keyword_set(_top))) then return, 0

 
 if(NOT keyword_set(top)) then top = _top $
 else _top = top
 if(NOT keyword_set(_primary)) then _primary = _top


 if(keyword_set(primary)) then top = _primary
 if(NOT widget_info(top, /valid_id)) then return, 0

 widget_control, top, get_uvalue=grim_data
 if(NOT keyword_set(dead)) then $
       if(NOT keyword_set(no_wset)) then grim_wset, grim_data, grim_data.wnum

 return, grim_data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_set_data</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_set_data:source"></a>pro grim_set_data, grim_data, top, primary=primary
@grim_block.include

 if(NOT keyword_set(top)) then top = _top $
 else _top = top
 if(NOT keyword_set(_primary)) then _primary = _top


 if(keyword_set(primary)) then top = _primary

<span class="comments">; if(NOT widget_info(top, /valid)) then return</span>
 widget_control, top, set_uvalue=grim_data

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_set_primary</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_set_primary:source"></a>pro grim_set_primary, top
@grim_block.include

 if(keyword__set(_primary)) then old_primary = _primary

 if(old_primary EQ top) then return

 _primary = top

 <span class="comments">;-----------------------------------</span>
 <span class="comments">; erase old primary frame</span>
 <span class="comments">;-----------------------------------</span>
<span class="comments">; if(widget_info(old_primary, /valid_id)) then $</span>
 if(widget_info(old_primary, /managed)) then $
  begin
   grim_data = grim_get_data(old_primary)
   grim_refresh, /use_pixmap, /no_objects, /no_image, grim_data, /noglass
  end

 <span class="comments">;-----------------------------------</span>
 <span class="comments">; set new primary and draw frame</span>
 <span class="comments">;-----------------------------------</span>
 grim_data = grim_get_data(_primary)
 _top = _primary
 grim_set_ct, grim_data
 grim_refresh, /no_image, /no_objects, grim_data, /noglass

 grim_call_primary_callbacks

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_set_mode_data</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_set_mode_data:source"></a>pro grim_set_mode_data, grim_data, data

 if(keyword_set(grim_data.mode_data_p)) then *grim_data.mode_data_p = data 

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_add_primary_callback</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_add_primary_callback:source"></a>pro grim_add_primary_callback, callbacks, data_ps
@grim_block.include

 grim_add_callback, callbacks, data_ps, _pm_callbacks, _pm_data_ps
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_rm_primary_callback</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_rm_primary_callback:source"></a>pro grim_rm_primary_callback, data_ps
@grim_block.include

 grim_rm_callback, data_ps, _pm_callbacks, _pm_data_ps
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_call_primary_callbacks</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_call_primary_callbacks:source"></a>pro grim_call_primary_callbacks
@grim_block.include

 grim_call_callbacks, _pm_callbacks, _pm_data_ps

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_add_plane_callback</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_add_plane_callback:source"></a>pro grim_add_plane_callback, callbacks, data_ps, top=top, no_wset=no_wset

 grim_data = grim_get_data(top, no_wset=no_wset)

 pn_callbacks = *grim_data.pn_callbacks_p
 rf_data_ps = *grim_data.pn_callbacks_data_pp

 grim_add_callback, callbacks, data_ps, pn_callbacks, rf_data_ps

 *grim_data.pn_callbacks_p = pn_callbacks
 *grim_data.pn_callbacks_data_pp = rf_data_ps

 grim_set_data, grim_data, grim_data.base
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_rm_plane_callback</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_rm_plane_callback:source"></a>pro grim_rm_plane_callback, data_ps, top=top

 grim_data = grim_get_data(top)
 if(NOT grim_exists(grim_data)) then return

 pn_callbacks = *grim_data.pn_callbacks_p
 rf_data_ps = *grim_data.pn_callbacks_data_pp

 grim_rm_callback, data_ps, pn_callbacks, rf_data_ps

 *grim_data.pn_callbacks_p = pn_callbacks
 *grim_data.pn_callbacks_data_pp = rf_data_ps

 grim_set_data, grim_data, grim_data.base
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_call_plane_callbacks</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_call_plane_callbacks:source"></a>pro grim_call_plane_callbacks, grim_data

 grim_call_callbacks, *grim_data.pn_callbacks_p, *grim_data.pn_callbacks_data_pp

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_get_selected</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_get_selected:source"></a>function grim_get_selected
@grim_block.include

 if(_selected[0] EQ -1) then return, 0

 n = n_elements(_selected)

 dead = bytarr(n)
 for i=0, n-1 do if(NOT widget_info(_selected[i], /valid_id)) then dead[i] = 1

 w = where(dead EQ 0)
 if(w[0] NE -1) then return, _selected[w]

 return, 0
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_select</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_select:source"></a>pro grim_select, grim_data
@grim_block.include

 grim_data.selected = NOT grim_data.selected

 if(grim_data.selected) then $
  begin
   widget_control, grim_data.select_button, set_value=grim_select_bitmap()
   if(_selected[0] EQ -1) then _selected = grim_data.base $
   else _selected = [_selected, grim_data.base]
   grim_print, grim_data, 'Image selected.'
  end $
 else $
  begin
   widget_control, grim_data.select_button, set_value=grim_unselect_bitmap()
   w = where(_selected EQ grim_data.base)
   if(w[0] NE -1) then _selected = rm_list_item(_selected, w[0], only=-1)
   grim_print, grim_data, 'Image deselected.'
  end

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_identify</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_identify:source"></a>pro grim_identify, grim_data

 print, '!'

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_grnum_create</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_grnum_create:source"></a>function grim_grnum_create, top
common grnum_block, tops

 if(NOT defined(tops)) then tops = -1


 grnum = (min(where(tops EQ -1)))[0]
 if(grnum EQ -1) then $
  begin
   grnum = n_elements(tops) 
   tops = [tops, top] 
  end $
 else tops[grnum] = top
 

 return, grnum
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_grnum_destroy</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_grnum_destroy:source"></a>pro grim_grnum_destroy, grnum
common grnum_block, tops

 tops[grnum] = -1

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_top_to_grnum</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_top_to_grnum:source"></a>function grim_top_to_grnum, top, new=new

 if(keyword_set(new)) then return, grim_grnum_create(top)

 grim_data = grim_get_data(top)
 return, grim_data.grnum
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_jump_to_plane</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_jump_to_plane:source"></a>pro grim_jump_to_plane, grim_data, pn, valid=valid, nosync=nosync

 if(NOT keyword_set(grim_data)) then grim_data = grim_get_data()

 <span class="comments">;-----------------------------------</span>
 <span class="comments">; verify valid plane</span>
 <span class="comments">;-----------------------------------</span>
 valid = 0
 flags = *grim_data.pl_flags_p

 if(pn GE n_elements(flags)) then return
 if(flags[pn] EQ 0) then return
 valid = 1

 <span class="comments">;-----------------------------------</span>
 <span class="comments">; change to next valid plane</span>
 <span class="comments">;-----------------------------------</span>
 grim_data.pn = pn

 grim_set_data, grim_data
 grim_call_plane_callbacks, grim_data
 if(NOT keyword_set(nosync)) then grim_sync_planes, grim_data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grim_sync_planes</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grim_sync_planes:source"></a>pro grim_sync_planes, grim_data, norefresh=norefresh
@grim_block.include

 if(NOT keyword_set(_all_tops)) then return

 plane = grim_get_plane(grim_data)
 pn = plane.pn 

 top = _top
 tops = _all_tops
 ntops = n_elements(tops)

 <span class="comments">;-------------------------------------------------</span>
 <span class="comments">; project arrays in other planes and windows</span>
 <span class="comments">;-------------------------------------------------</span>
 for i=0, ntops-1 do if(tops[i] NE top) then $
  begin
   _grim_data = grim_get_data(tops[i])

   if(grim_data.type NE 'plot') then $
    if(grim_get_toggle_flag(_grim_data, 'PLANE_SYNCING')) then $
     if(_grim_data.n_planes NE 1) then $
      begin
       grim_jump_to_plane, _grim_data, pn, /nosync 
       grim_refresh, _grim_data
      end
  end

 grim_data = grim_get_data(top)
end
<span class="comments">;=============================================================================</span>

<a id="grim_data_include:source"></a>pro grim_data_include
a=!null
end

</code>
    </div>
  </body>
</html>