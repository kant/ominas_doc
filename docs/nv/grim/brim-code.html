<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 20:37:26 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>brim.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="brim.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;=============================================================================</span>
<span class="comments">;+-+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	brim</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Image browser.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;	NV/GR</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	brim, files</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; ARGUMENTS:</span>
<span class="comments">;  INPUT:</span>
<span class="comments">;	files:	List of filenames and file specifications.  Only files whose</span>
<span class="comments">;		filetypes can be detected are loaded.  If this argument is not</span>
<span class="comments">;		given, the user is prompted for a list of files.  An array of</span>
<span class="comments">;		data descriptors may also be specified.</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;  INPUT:</span>
<span class="comments">;	thumbsize:	Size of the thumbnal images.  Default is 100 pixels.</span>
<span class="comments">;			Thumbnail images are alwasy square.</span>
<span class="comments">;</span>
<span class="comments">;	labels:		Labels to use for each thumbnail.  If none given, the</span>
<span class="comments">;			filename is used, is one exists.</span>
<span class="comments">;</span>
<span class="comments">;	ids:		Array to identify each thumbnail.  If none given, the</span>
<span class="comments">;			labels are used, if they exist.</span>
<span class="comments">;</span>
<span class="comments">;	select_ids:	Ids of Initial thumbnail(s) to appear selected.</span>
<span class="comments">;</span>
<span class="comments">;	left_fn:	Name of a procedure to call when the left mouse button</span>
<span class="comments">;			is clicked on a thumbnail.  Default procedure selects</span>
<span class="comments">;			that image and opens it in a new grim window.  The</span>
<span class="comments">;			user procedure is called as follows: </span>
<span class="comments">;</span>
<span class="comments">;				left_fn, fn_data, i, id, status=status</span>
<span class="comments">;</span>
<span class="comments">;			fn_data is supplied by the caller through the fn_data</span>
<span class="comments">;			keyword, i is the index of the thumbnail, id is the</span>
<span class="comments">;			thumbnail id as given by the ids keyword,</span>
<span class="comments">;			and status should return 0 if successful and nonzero</span>
<span class="comments">;			otherwise.</span>
<span class="comments">;</span>
<span class="comments">;	middle_fn:	Name of a procedure to call when the middle mouse button</span>
<span class="comments">;			is clicked on a thumbnail.  There is no default.</span>
<span class="comments">;</span>
<span class="comments">;	right_fn:	Name of a procedure to call when the right mouse button</span>
<span class="comments">;			is clicked on a thumbnail.  There is no default.</span>
<span class="comments">;</span>
<span class="comments">;	fn_data:	Data to be supplied to the above user procedures.</span>
<span class="comments">;</span>
<span class="comments">;	exclusive_selection:	</span>
<span class="comments">;			If set, only one image may be selected at once.  </span>
<span class="comments">;			(Currently multiple image selection is not supported.)</span>
<span class="comments">;</span>
<span class="comments">;	path:		Initial path to use for the file selection widget, </span>
<span class="comments">;			which appears only if the file argument is not given. </span>
<span class="comments">;</span>
<span class="comments">;	modal:		If set, only the brim widget may be used until it</span>
<span class="comments">;			is closed.</span>
<span class="comments">;</span>
<span class="comments">;	title:		Title to use for the brim widget instead of 'brim'.</span>
<span class="comments">;</span>
<span class="comments">;	order:		Display order for thumbnails.  Default is 0.</span>
<span class="comments">;</span>
<span class="comments">;	filter:		Initial filter to use when loading files.</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT:</span>
<span class="comments">;	get_path:	Final path selected in the file selection widget.</span>
<span class="comments">;</span>
<span class="comments">;	select_ids:	On return, select_ids contains the ids of the selected</span>
<span class="comments">;			images.  If there are no selections, its value will be</span>
<span class="comments">;			the null string: ''.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; RETURN:</span>
<span class="comments">;	NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;	brim may be run standalone or from within grim.  If no files or data</span>
<span class="comments">;	descriptors are given, brim first prompts the user to select a list of</span>
<span class="comments">;	files.  brim then displays thumbnails of all valid files.  Files may be</span>
<span class="comments">;	selected by clicking with the left mouse button.  By default, the image</span>
<span class="comments">;	is opened in a new grim window.  Alternate actions may be defined</span>
<span class="comments">;	through procedures supplied by the caller.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;	To load files into brim using a file-selection widget:</span>
<span class="comments">;</span>
<span class="comments">;	 IDL> brim</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;	To load all recognizeable images in the current directory into brim:</span>
<span class="comments">;</span>
<span class="comments">;	 IDL> brim, '*'</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;	To browse a set of data descriptors:</span>
<span class="comments">;</span>
<span class="comments">;	 IDL> dd = dat_read('*')</span>
<span class="comments">;	 IDL> brim, dd</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; STATUS:</span>
<span class="comments">;	Complete.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">; 	Written by:	Spitale, 10/2002</span>
<span class="comments">;	</span>
<span class="comments">;-</span>
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_display_image</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_display_image:source"></a>pro brim_display_image, brim_data, _i, image

 i = _i[0]

 if(NOT keyword_set(image)) then image = (*brim_data.images_p)[*,*,i]

 wset, brim_data.wnums[i]
 tvscl, image, order=brim_data.order

 if(keyword_set(brim_data.labels)) then $
    widget_control, brim_data.label_widgets[i], set_value=brim_data.labels[i]


end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_resolve_ids</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_resolve_ids:source"></a>function brim_resolve_ids, brim_data, ids

 n = n_elements(ids)
 i = lonarr(n)
 for j=0, n-1 do $
  begin
   w = where(ids[j] EQ brim_data.ids)   
   if(w[0] NE -1) then i[j] = w[0]
  end

 return, i
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_load</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_load:source"></a>pro brim_load, brim_data, files, display=display

 if(ptr_valid(brim_data.images_p)) then nv_ptr_free, brim_data.images_p


 n = n_elements(files)

 images = dblarr(brim_data.thumbsize, brim_data.thumbsize, n)

 for i=0, n-1 do $
  begin
   <span class="comments">;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
   <span class="comments">; if files is a string, then assume it gives filenames.</span>
   <span class="comments">;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
   if(size(files, /type) EQ 7) then $
    begin
     _im = 0
     dd = dat_read(files[i], _im)<span class="comments">;, maintain=2)</span>
     if(obj_valid(dd[0])) then nv_free, dd
    end $
   <span class="comments">;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
   <span class="comments">; otherwise, assume it gives data descriptors.</span>
   <span class="comments">;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
   else  _im = dat_data(files[i])
<span class="comments">; need to sample images with dat_data instead of congrid</span>

   if(keyword_set(_im)) then $
    if((size(_im))[0] EQ 2) then $
     begin
      images[*,*,i] = congrid(_im, brim_data.thumbsize, brim_data.thumbsize)

      if(keyword_set(display)) then $
                  brim_display_image, brim_data, i, images[*,*,i]
     end
  end


 brim_data.images_p = nv_ptr_new(images)


 widget_control, brim_data.base, set_uvalue=brim_data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_configure</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_configure:source"></a>function brim_configure, brim_data, n, files=files, base=base, $
     thumbsize=thumbsize, labels=labels, $
     select_ids=select_ids, $
     left_fn=left_fn, right_fn=right_fn, middle_fn=middle_fn, fn_data=fn_data, $
     exclusive_selection=exclusive_selection, path=path, get_path=get_path, $
     modal=modal, title=title, ids=ids, order=order, filter=filter, $
     enable_selection=enable_selection

 label_ysize = 30
<span class="comments">; label_ysize = 22</span>
 nmore = 0

 if(keyword_set(brim_data)) then $
  begin
   if(NOT defined(enable_selection)) then $
                           enable_selection = brim_data.enable_selection
   if(NOT defined(order)) then order = brim_data.order
   if(NOT defined(exclusive_selection)) then $
                           exclusive_selection = brim_data.exclusive_selection
   if(NOT defined(fn_data)) then fn_data = brim_data.fn_data
   if(NOT defined(middle_fn)) then middle_fn = brim_data.middle_fn  
   if(NOT defined(right_fn)) then right_fn = brim_data.right_fn
   if(NOT defined(left_fn)) then left_fn = brim_data.left_fn  
   if(NOT defined(thumbsize)) then thumbsize = brim_data.thumbsize

   draw_bases = brim_data.draw_bases
   scroll_base = brim_data.scroll_base
   draw_widgets = brim_data.draw_widgets
   label_widgets = brim_data.label_widgets
   wnums = brim_data.wnums

   if(ptr_valid(brim_data.select_ids_p)) then nv_ptr_free, brim_data.select_ids_p
   if(ptr_valid(brim_data.images_p)) then nv_ptr_free, brim_data.images_p

   n = n_elements(brim_data.draw_bases)
   nmore = n_elements(files) - n
   if(nmore NE 0) then base = brim_data.base
  end 

 <span class="comments">;------------------------------------</span>
 <span class="comments">; widgets</span>
 <span class="comments">;------------------------------------</span>
 if(nmore LT 0) then $
  begin
   widget_control, /destroy, brim_data.draw_bases[n-1]
   draw_bases = brim_data.draw_bases[0:n-2]
   draw_widgets = brim_data.draw_widgets[0:n-2]
   label_widgets = brim_data.label_widgets[0:n-2]
   wnums = brim_data.wnums[0:n-2]
  end

 if(keyword_set(base) OR (nmore GT 0)) then $
  begin
<span class="comments">;   done_button = widget_button(base, value='Done')</span>

   scroll_base = widget_info(base, /child)
   widget_control, scroll_base, get_uvalue=nx

   nn = n + nmore
   ny = nn/nx + (nn mod nx NE 0)

   xsize = 600 &lt; nx*thumbsize * 1.1
   ysize = 800 &lt; (ny*(thumbsize + label_ysize) * 1.1)

   widget_control, scroll_base, scr_xsize=xsize, scr_ysize=ysize
<span class="comments">;   widget_control, base, scr_xsize=xsize, scr_ysize=ysize</span>

   nnn = nn
   if(keyword_set(brim_data)) then nnn = nmore
   for i=0, nnn-1 do $
    begin
     draw_base = widget_base(scroll_base, xpad=0, ypad=0, $
                     xsize=thumbsize, ysize=thumbsize+label_ysize, /frame, /col)
     draw_bases = append_array(draw_bases, draw_base)

     draw_widget = $
         widget_draw(draw_base, xsize=thumbsize, ysize=thumbsize, $
                 /button_events, event_pro='brim_draw_event', /motion_events,  $
                 retain=2, /tracking_events)
     draw_widgets = append_array(draw_widgets, draw_widget)

     label_widget = $
<span class="comments">;          widget_label(draw_base, /align_left, xsize=thumbsize, value=' ')</span>
          widget_text(draw_base, /align_left, xsize=thumbsize, value=' ')
     label_widgets = append_array(label_widgets, label_widget)
    end


   widget_control, /realize, base
   wnums = lonarr(nn)
   for i=0, nn-1 do $
    begin
     widget_control, draw_widgets[i], get_value=wnum
     wnums[i] = wnum
    end

  end


 <span class="comments">;----------------------------------</span>
 <span class="comments">; data structure</span>
 <span class="comments">;----------------------------------</span>
 if(NOT keyword_set(base)) then base = brim_data.base

 if(NOT keyword_set(labels)) then $
  begin
   fnames = cor_name(files)
   split_filename, fnames, dirs, labels
  end
 if(keyword_set(ids)) then $
  begin
   w = str_isnum(strtrim(ids,2))
   if( (w[0] NE -1) AND $
           (n_elements(w) EQ n_elements(labels)) ) then $
                               labels = strtrim(ids,2) + ':' + labels
  end

 if(NOT keyword_set(ids)) then ids = labels

 if(exclusive_selection) then $
          if(NOT defined(select_ids)) then select_ids = ids[0]
 if(NOT exclusive_selection) then $
          if(NOT defined(select_ids)) then select_ids = ''

 brim_data = { $
		base			:	base, $
		select_ids_p		:	nv_ptr_new(select_ids), $
		enable_selection	:	enable_selection, $
		left_fn			:	left_fn, $
		middle_fn		:	middle_fn, $
		right_fn		:	right_fn, $
		fn_data			:	fn_data, $
		images_p		:	nv_ptr_new(), $
		wnums			:	wnums, $
		draw_bases		:	draw_bases, $
		scroll_base		:	scroll_base, $
		draw_widgets		:	draw_widgets, $
		label_widgets		:	label_widgets, $
		labels			:	labels, $
		ids			:	ids, $
		exclusive_selection	:	exclusive_selection, $
		files			:	files, $
		order			:	order, $
		base_xsize		:	0l, $
		base_ysize		:	0l, $
		scroll_xsize		:	0l, $
		scroll_ysize		:	0l, $
		thumbsize		:	thumbsize $
	}

 geom = widget_info(base, /geom)
 brim_data.base_xsize = geom.xsize
 brim_data.base_ysize = geom.ysize

 geom = widget_info(scroll_base, /geom)
 brim_data.scroll_xsize = geom.scr_xsize
 brim_data.scroll_ysize = geom.scr_ysize

 widget_control, base, set_uvalue=brim_data

 <span class="comments">;----------------------------------</span>
 <span class="comments">; load and display images</span>
 <span class="comments">;----------------------------------</span>
 widget_control, /hourglass
 brim_load, brim_data, files, /display

 return, brim_data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_select</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_select:source"></a>pro brim_select, brim_data, _i, id=id, dd=dd

<span class="comments">; ;------------------------------------------</span>
<span class="comments">; ; if dd given, then need to reload images</span>
<span class="comments">; ;------------------------------------------</span>
<span class="comments">; if(keyword__set(dd)) then $</span>
<span class="comments">;  begin</span>
<span class="comments">;   brim_data = brim_configure(brim_data, files=dd, id=id)</span>
<span class="comments">;  end</span>


 if(NOT brim_data.enable_selection) then return

 <span class="comments">;-------------------------------------</span>
 <span class="comments">; resolve ids if necessary</span>
 <span class="comments">;-------------------------------------</span>
 if(keyword__set(id)) then i = brim_resolve_ids(brim_data, _i) $
 else i = _i

 new_selection = 1
 <span class="comments">;------------------------------------------</span>
 <span class="comments">; exclusive selection</span>
 <span class="comments">;------------------------------------------</span>
 if(brim_data.exclusive_selection) then $
  begin 
   <span class="comments">;- - - - - - - - - - - - - - - -</span>
   <span class="comments">; erase current selection</span>
   <span class="comments">;- - - - - - - - - - - - - - - -</span>
   ii = brim_resolve_ids(brim_data, *brim_data.select_ids_p)
   brim_display_image, brim_data, ii

   <span class="comments">;- - - - - - - - - - - - - - - -</span>
   <span class="comments">; set new selection</span>
   <span class="comments">;- - - - - - - - - - - - - - - -</span>
   *brim_data.select_ids_p = brim_data.ids[i]
  end $
 <span class="comments">;------------------------------------------</span>
 <span class="comments">; general selection</span>
 <span class="comments">;------------------------------------------</span>
 else $
  begin
   if((*brim_data.select_ids_p)[0] EQ '') then $
                                  *brim_data.select_ids_p = brim_data.ids[i] $
   else $
    begin
     w = where(*brim_data.select_ids_p EQ brim_data.ids[i])

     <span class="comments">;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
     <span class="comments">; add selection if not already selected, otherwise delete selection</span>
     <span class="comments">;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
     if(w[0] EQ -1) then $
       *brim_data.select_ids_p = [*brim_data.select_ids_p, brim_data.ids[i]] $
     else $
      begin
       *brim_data.select_ids_p = $
                           rm_list_item(*brim_data.select_ids_p, w[0], only='')
       brim_display_image, brim_data, i
       new_selection = 0
      end
    end
  end

 <span class="comments">;------------------------------------------</span>
 <span class="comments">; highlight new selection</span>
 <span class="comments">;------------------------------------------</span>
 if(new_selection) then $
  begin
   wset, brim_data.wnums[i]

   xs = !d.x_size-3
   ys = !d.y_size-3
   plots, [1,xs,xs,1,1], [1,1,ys,ys,1], /device, col=ctred(), th=2
  end


 widget_control, brim_data.base, set_uvalue=brim_data
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_fn_grim</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_fn_grim:source"></a>pro brim_fn_grim, brim_data, i, label, status=status

 status = 0

 if(size(brim_data.files, /type) EQ 7) then dd = dat_read(brim_data.files[i]) $
 else dd = brim_data.files[i]

 widget_control, /hourglass

 if(brim_data.order NE -1) then order = brim_data.order
 grim, /new, dd, order=order

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_event</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_event:source"></a>pro brim_event, event

 base = event.top
 widget_control, base, get_uvalue=brim_data 
 struct = tag_names(event, /struct)

 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; adjust base size</span>
 <span class="comments">;-----------------------------------------------</span>
 if(struct EQ 'WIDGET_BASE') then $
  begin
   dx = event.x - brim_data.base_xsize
   dy = event.y - brim_data.base_ysize

   widget_control, brim_data.scroll_base, $
         scr_xsize=brim_data.scroll_xsize+dx, scr_ysize=brim_data.scroll_ysize+dy

   geom = widget_info(base, /geom)
   brim_data.base_xsize = geom.xsize
   brim_data.base_ysize = geom.ysize

   geom = widget_info(brim_data.scroll_base, /geom)
   brim_data.scroll_xsize = geom.scr_xsize
   brim_data.scroll_ysize = geom.scr_ysize

   widget_control, base, set_uvalue=brim_data
   return
  end


 widget_control, brim_data.base, /destroy

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim_draw_event</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim_draw_event:source"></a>pro brim_draw_event, event


 widget_control, event.top, get_uvalue=brim_data 

 i = where(event.id EQ brim_data.draw_widgets)

 struct = tag_names(event, /struct)
 if(struct EQ 'WIDGET_TRACKING') then return

 <span class="comments">;--------------------------</span>
 <span class="comments">; motion events</span>
 <span class="comments">;--------------------------</span>
 if(event.type EQ 2) then $
  begin
   wset, brim_data.wnums[i]
   device, cursor_standard=60
  end

 <span class="comments">;--------------------------</span>
 <span class="comments">; button-press events</span>
 <span class="comments">;--------------------------</span>
 if(event.type NE 0) then return 

 fn_data = brim_data.fn_data
 if(NOT keyword_set(fn_data)) then fn_data = brim_data

 case event.press of
  1 : $
   begin
    status = 0
    if(keyword__set(brim_data.left_fn)) then $
           call_procedure, brim_data.left_fn, fn_data, i, $
                                          brim_data.ids[i], status=status
    if(status EQ 0) then brim_select, brim_data, i
   end
  2 : if(keyword__set(brim_data.middle_fn)) then $
           call_procedure, brim_data.middle_fn, fn_data, i, $
                                          brim_data.ids[i], status=status
  4 : if(keyword__set(brim_data.right_fn)) then $
           call_procedure, brim_data.right_fn, fn_data, i, $
                                          brim_data.ids[i], status=status
  else:
 endcase


end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; brim</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="brim:source"></a>pro brim, files, thumbsize=thumbsize, labels=labels, select_ids=select_ids, $
     left_fn=left_fn, right_fn=right_fn, middle_fn=middle_fn, fn_data=fn_data, $
     exclusive_selection=exclusive_selection, path=path, get_path=get_path, $
     modal=modal, title=title, ids=ids, order=order, filter=filter, $
     enable_selection=enable_selection, base=base

 if(NOT defined(left_fn)) then left_fn = 'brim_fn_grim'

 if(NOT defined(middle_fn)) then middle_fn = ''
 if(NOT defined(right_fn)) then right_fn = ''
 if(NOT keyword_set(fn_data)) then fn_data = ''
 if(NOT keyword_set(exclusive_selection)) then exclusive_selection = 0
 if(NOT keyword_set(order)) then order = -1
 enable_selection = keyword_set(enable_selection)
 if(NOT keyword_set(thumbsize)) then thumbsize = 100

 <span class="comments">;----------------------------------</span>
 <span class="comments">; select files if none given</span>
 <span class="comments">;----------------------------------</span>
 if(NOT keyword_set(files)) then $
  begin
   files = $
    pickfiles(get_path=get_path, title='Select files to load', $
                                               path=path, filter=filter)
   if(NOT keyword_set(files[0])) then return
  end 
 
 <span class="comments">;---------------------------------------------------------</span>
 <span class="comments">; resolve any file specifications and determine filetypes</span>
 <span class="comments">;---------------------------------------------------------</span>
 if(size(files, /type) EQ 7) then $
  begin
   for i=0, n_elements(files)-1 do $
    begin
     if(strpos(files[i], '/') EQ -1) then files[i] = pwd() + '/' + files[i]
     ff = file_search(files[i])
     if(keyword_set(ff)) then _files = append_array(_files, ff)
    end
   if(NOT keyword_set(_files)) then return
   files = _files

   w = where(files NE '')
   if(w[0] EQ -1) then return
   files = files[w]

   w = where(strpos(files,':') EQ -1)
   if(w[0] EQ -1) then return
   files = files[w]

   w = where(strpos(files,'/') NE -1)
   if(w[0] EQ -1) then return
   files = files[w]

   if(NOT keyword_set(files)) then return

   split_filename, files, dirs, names
   labels = names  
  end

 <span class="comments">;----------------------------------</span>
 <span class="comments">; geometry</span>
 <span class="comments">;----------------------------------</span>
 n = n_elements(files) 

 nx = sqrt(n)
 if((nx mod 1) NE 0) then nx = fix(nx) + 1

 <span class="comments">;----------------------------------</span>
 <span class="comments">; widgets</span>
 <span class="comments">;----------------------------------</span>
 if(NOT keyword_set(title)) then title = 'brim'

<span class="comments">; base = widget_base(title=title, /column, /tlb_size_events)</span>
 base = widget_base(title=title, /tlb_size_events)

 scroll_base = widget_base(base, xpad=0, ypad=0, /scroll, col=nx, space=0)
 widget_control, scroll_base, set_uvalue=nx

 brim_data = brim_configure(0, n, files=files, base=base, $
     thumbsize=thumbsize, labels=labels, $
     select_ids=select_ids, $
     left_fn=left_fn, right_fn=right_fn, middle_fn=middle_fn, fn_data=fn_data, $
     exclusive_selection=exclusive_selection, path=path, get_path=get_path, $
     modal=modal, title=title, ids=ids, order=order, filter=filter, $
     enable_selection=enable_selection)



 <span class="comments">;----------------------------------</span>
 <span class="comments">; show initial selections</span>
 <span class="comments">;----------------------------------</span>
 if(keyword_set(select_ids)) then brim_select, brim_data, select_ids, /id


 no_block = 1
 if(keyword_set(modal)) then no_block = 0
 xmanager, 'brim', base, no_block=no_block


 select_ids = *brim_data.select_ids_p
end
<span class="comments">;=============================================================================</span>
</code>
    </div>
  </body>
</html>