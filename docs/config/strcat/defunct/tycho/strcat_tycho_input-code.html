<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 20:36:47 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>strcat_tycho_input.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="strcat_tycho_input.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;===============================================================================</span>
<span class="comments">; docformat = 'rst'</span>
<span class="comments">;+</span>
<span class="comments">;</span>
<span class="comments">;        Input translator for Tycho-1 star catalog.</span>
<span class="comments">;</span>
<span class="comments">; Usage</span>
<span class="comments">; =====</span>
<span class="comments">; This routine is called via `dat_get_value`, which is used to read the</span>
<span class="comments">; translator table. In particular, the specific translator for the scene</span>
<span class="comments">; to be processed should contain the following line::</span>
<span class="comments">;</span>
<span class="comments">;      -   strcat_tycho_input     -       /j2000    # or /b1950 if desired</span>
<span class="comments">;</span>
<span class="comments">; For the star catalog translator system to work properly, only one type</span>
<span class="comments">; of catalog may be used at a time for a particular instrument.</span>
<span class="comments">; The version of the TYCHO catalog that this translator expects can be</span>
<span class="comments">; obtained from the original CD's. The catalog data is grouped into </span>
<span class="comments">; approx 10,000 separate regions in numbered files in 24 separate </span>
<span class="comments">; subdirectories. Each star has a data record of 16 bytes.Two identifying</span>
<span class="comments">; numbers: TYCHO_ID_1 and TYCHO_ID_2, RA_DEG and DEC_DEG (degrees), </span>
<span class="comments">; RApm and DECpm (milliarcseconds/year), and MAG (Visual Magnitude). </span>
<span class="comments">; The real values (RA_DEG, DEC_DEG, RApm, DECpm, and MAG) are in XDR,</span>
<span class="comments">; the GSC_ID and CLASS are network-order short integers.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; Restrictions</span>
<span class="comments">; ============</span>
<span class="comments">; </span>
<span class="comments">; Since the distance to stars are not given in the GSC catalog, the</span>
<span class="comments">; position vector magnitude is set as 10 parsec and the luminosity</span>
<span class="comments">; is calculated from the visual magnitude and the 10 parsec distance.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; Procedure</span>
<span class="comments">; =========</span>
<span class="comments">; </span>
<span class="comments">; Stars are found in a square area in RA and DEC around a given</span>
<span class="comments">; or calculated center.  The star descriptor is filled with stars</span>
<span class="comments">; that fit in this area.  If B1950 is selected, input RA, DEC and/or</span>
<span class="comments">;	ods orient matrix is assumed to be B1950 also, if not, input is</span>
<span class="comments">;	assumed to be J2000, like the catalog.  </span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">; nv, config</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;       Written by:     Vance Haemmerle, 3/2000</span>
<span class="comments">;</span>
<span class="comments">;       Modified:       Tiscareno, 8/2000</span>
<span class="comments">;</span>
<span class="comments">;	      Modified:	      Haemmerle, 12/2000</span>
<span class="comments">;</span>
<span class="comments">;       Modified:       Spitale 9/2001</span>
<span class="comments">;</span>
<span class="comments">;-</span>
<span class="comments">;===============================================================================</span>

<span class="comments">;===============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; :Private:</span>
<span class="comments">; :Hidden:</span>
<span class="comments">;-</span>
<span class="comments">;===============================================================================</span>
<a id="tycho_fzone:source"></a>function tycho_fzone, declow, dechi

  dec = (declow + dechi) / 2.0
  zone = fix (dec / (90./12.)) + 1
  if (dec lt 0) then begin
    zone = (12 + 2) - zone
  endif

  return, zone
end

<span class="comments">;+</span>
<span class="comments">; :Private:</span>
<span class="comments">; :Hidden:</span>
<span class="comments">; Initialize zone directory names for TYCHO catalog</span>
<span class="comments">;-</span>
<a id="tycho_initzd:source"></a>pro tycho_initzd, zdir

  zdir(0)  = 'N0000'
  zdir(1)  = 'N0730'
  zdir(2)  = 'N1500'
  zdir(3)  = 'N2230'
  zdir(4)  = 'N3000'
  zdir(5)  = 'N3730'
  zdir(6)  = 'N4500'
  zdir(7)  = 'N5230'
  zdir(8)  = 'N6000'
  zdir(9)  = 'N6730'
  zdir(10) = 'N7500'
  zdir(11) = 'N8230'

  zdir(12) = 'S0000'
  zdir(13) = 'S0730'
  zdir(14) = 'S1500'
  zdir(15) = 'S2230'
  zdir(16) = 'S3000'
  zdir(17) = 'S3730'
  zdir(18) = 'S4500'
  zdir(19) = 'S5230'
  zdir(20) = 'S6000'
  zdir(21) = 'S6730'
  zdir(22) = 'S7500'
  zdir(23) = 'S8230'
end
<span class="comments">;===============================================================================</span>




<span class="comments">;===============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; :Private:</span>
<span class="comments">; :Hidden:</span>
<span class="comments">; Search the index table to find the region identifiers whose coordinate</span>
<span class="comments">; limits overlap the specified field. Save list of paths to gsc files for</span>
<span class="comments">; these regions.</span>
<span class="comments">; :Params:</span>
<span class="comments">;   ra1 : in, required, type=double</span>
<span class="comments">;      lower bound in right ascension of scene in hours</span>
<span class="comments">;   ra2 : in, required, type=double</span>
<span class="comments">;      upper bound in right ascension of scene in hours</span>
<span class="comments">;   dec1 : in, required, type=double</span>
<span class="comments">;      lower bound in declination of scene in degrees</span>
<span class="comments">;   dec2 : in, required, type=double</span>
<span class="comments">;      upper bound in declination of scene in degrees</span>
<span class="comments">;      </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;    path_tycho : in, required, type=string, default='NV_TYCHO_DATA'</span>
<span class="comments">;       Sets the path to look for catalog files. Uses the value of</span>
<span class="comments">;       the NV_TYCHO_DATA environment variable by default.</span>
<span class="comments">;       </span>
<span class="comments">; :Returns:</span>
<span class="comments">;    Table to store regions found (to search for guide stars)</span>
<span class="comments">;    </span>
<span class="comments">;-</span>
<a id="tycho_get_regions:source"></a>function tycho_get_regions, ra1, ra2, dec1, dec2, path_tycho=path_tycho

  <span class="comments">; Initialize the directory name for each zone</span>
  zdir = strarr(24)
  tycho_initzd, zdir
  rows = 9537
  num_regions = 0

  region_file = path_tycho + "/" + "regions.index"
  if(!VERSION.OS eq 'vms') then $
   begin
    len = strlen(path_tycho)
    lastchar = strmid(path_tycho,len-1,1)
    if(lastchar eq ']' or lastchar eq ':') then $
      region_file = path_tycho + "regions.index"
    if(lastchar eq '.') then region_file = $
     strmid(path_tycho,0,len-1) + "]" + "regions.index"
   end

  get_lun, lun
  openr, lun, region_file
  tycho_region_table = assoc(lun,{tycho_region})

  region_list = ''
  for row = 0, rows-1 do begin
    <span class="comments">; For each row in the tycho_region_table</span>
    region_table = tycho_region_table[row]

    <span class="comments">; Declination range of the Tycho/GSC region</span>
    <span class="comments">; Note:  southern dechi and declow are reversed</span>
    dechi = region_table.DEC_HI
    byteorder, dechi, /XDRTOF

    if (dechi gt 0 and dechi lt dec1) then begin
      goto,next
    endif else if (dechi lt 0 and dechi gt dec2) then begin
      goto,next
    endif

    <span class="comments">; Limit of Tycho/GSC region closer to equator</span>
    declow = region_table.DEC_LO
    byteorder, declow, /XDRTOF

    if (declow gt 0) then begin
      <span class="comments">; North</span>
      if (declow gt dec2) then goto,next
    endif else if (declow lt 0) then  begin
      <span class="comments">; South</span>
      if (declow le dec1) then goto, next
    endif else begin
      <span class="comments">; Lower limit of Tycho/GSC region ON equator</span>
      if (dechi gt 0) then begin
        <span class="comments">; North</span>
        if (dechi lt dec1 or declow gt dec2) then goto, next
      endif else if (dechi &lt; 0) then begin
        <span class="comments">; South</span>
        if (dechi gt dec2 or declow lt dec1) then goto, next
      endif
    endelse

    <span class="comments">; Right ascension range of the Tycho/GSC region</span>
    if (ra1 lt ra2) then begin
      <span class="comments">; 0 R.A. not in region</span>

      ralow = region_table.RA_LOW
      byteorder, ralow, /XDRTOF
      if (ralow gt ra2) then goto, next

      rahi = region_table.RA_HI
      byteorder, rahi, /XDRTOF
      if (ralow gt rahi) then rahi = rahi + 360.0
      if (rahi lt ra1) then goto, next

    endif else begin

      <span class="comments">; 0 R.A. in region</span>
      ralow = region_table.RA_LOW
      byteorder, ralow, /XDRTOF
      rahi = region_table.RA_HI
      byteorder, rahi, /XDRTOF

      if (ralow gt rahi) then rahi = rahi + 360.0
      if (ralow gt ra2 and rahi lt ra1) then goto, next

    endelse

    <span class="comments">; Region number</span>
    regnum = region_table.REG_NO
    byteorder, regnum, /NTOHS

    <span class="comments">; Zone number => directory name</span>
    zone = tycho_fzone (declow, dechi)

    <span class="comments">; Build the file name</span>
    root = string(format='(i4.4,".str")',regnum)

    path = string(format='(a,"/",a,"/")',path_tycho,zdir(zone-1))
    if(!VERSION.OS eq 'vms') then $
     begin
      len = strlen(path_tycho)
      lastchar = strmid(path_tycho,len-1,1)
      if(lastchar eq ']') then path = $
       strmid(path_tycho,0,len-1) + "." + zdir(zone-1) + "]"
      if(lastchar eq ':') then path = $
       path_tycho + "[" + zdir(zone-1) + "]"
      if(lastchar eq '.') then path = $
       path_tycho + zdir(zone-1) + "]"
     end

    if(num_regions eq 0) then region_list = path+root $
    else region_list = [region_list, path+root]
    num_regions = num_regions + 1

next: a = 1
  endfor

 close, lun
 free_lun, lun
 return, region_list
end
<span class="comments">;===============================================================================</span>




<span class="comments">;===============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; :Private:</span>
<span class="comments">; :Hidden:</span>
<span class="comments">; Ingests a set of records from the TYCHO-2 star catalog and generates star </span>
<span class="comments">; descriptors for each star within a specified scene.</span>
<span class="comments">;</span>
<span class="comments">; :Returns:</span>
<span class="comments">;   array of star descriptors</span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;   dd : in, required, type="data descriptor"</span>
<span class="comments">;      data descriptor</span>
<span class="comments">;   filename : in, required, type=string</span>
<span class="comments">;      name of index file, or regions file</span>
<span class="comments">;  </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;   b1950 : in, optional, type=string</span>
<span class="comments">;      if set, coordinates are output wrt b1950</span>
<span class="comments">;   ra1 : in, required, type=double</span>
<span class="comments">;      lower bound in right ascension of scene</span>
<span class="comments">;   ra2 : in, required, type=double</span>
<span class="comments">;      upper bound in right ascension of scene</span>
<span class="comments">;   dec1 : in, required, type=double</span>
<span class="comments">;      lower bound in declination of scene</span>
<span class="comments">;   dec2 : in, required, type=double</span>
<span class="comments">;      upper bound in declination of scene</span>
<span class="comments">;   faint : in, optional, type=double</span>
<span class="comments">;      stars with magnitudes fainter than this will not be returned</span>
<span class="comments">;   bright : in, optional, type=double</span>
<span class="comments">;      stars with magnitudes brighter than this will not be returned</span>
<span class="comments">;   nbright : in, optional, type=double</span>
<span class="comments">;      if set, selects only the n brightest stars</span>
<span class="comments">;   names : in, optional, type="string array"</span>
<span class="comments">;      if set, will return only the stars with the expected names</span>
<span class="comments">;   mag : out, required, type=double</span>
<span class="comments">;      magnitude of returned stars</span>
<span class="comments">;   jtime : in, optional, type=double</span>
<span class="comments">;      Years since 1950 (the epoch of catalog) for precession</span>
<span class="comments">;      and proper motion correction. If not given, it is taken</span>
<span class="comments">;      from the object descriptor bod_time, which is assumed to</span>
<span class="comments">;      be seconds past 2000, unless keyword /b1950 is set</span>
<span class="comments">;-</span>
<span class="comments">;===============================================================================</span>
<a id="tycho_get_stars:source"></a>function tycho_get_stars, filename, b1950=b1950, $
         jtime=jtime, ra1=ra1, ra2=ra2, dec1=dec1, dec2=dec2, $
         faint=faint, bright=bright, names=names, mag=mag

 f = findfile(filename)
 if(f[0] eq '') then $
  begin
   print, 'tycho_get_stars: File does not exist - ',filename
   return, ''
  end

 <span class="comments">;----------------------------------------------</span>
 <span class="comments">; Open file, expected name ends with "nnnn.str"</span>
 <span class="comments">; where nnnn is the Tycho/GSC region</span>
 <span class="comments">;----------------------------------------------</span>
 start = strpos(filename,'.str') - 4
 tycho_region = strmid(filename,start,4)
 openr, tycho_unit, filename, /get_lun
 info = fstat(tycho_unit)
 nstars = info.size/24
 stars = replicate({tycho_record},nstars)
 readu, tycho_unit, stars
 close, tycho_unit
 free_lun, tycho_unit

 <span class="comments">;-------------------------------------</span>
 <span class="comments">; select within magnitude limits</span>
 <span class="comments">;-------------------------------------</span>
 if(n_elements(faint) NE 0) then $
  begin
   faint = double(faint)
   mag = stars.mag
   byteorder, mag, /XDRTOF
   w = where(mag LE faint)
   if(w[0] NE -1) then _stars = stars[w]
   if(NOT keyword__set(_stars)) then return, ''
   stars = _stars
  end

 if(n_elements(bright) NE 0) then $
  begin
   bright = double(bright)
   mag = stars.mag
   byteorder, mag, /XDRTOF
   w = where(mag GE bright)
   if(w[0] NE -1) then __stars = stars[w]
   if(NOT keyword__set(__stars)) then return, ''
   stars = __stars
  end

 <span class="comments">;-------------------------</span>
 <span class="comments">; Unpack the star array</span>
 <span class="comments">;-------------------------</span>
 RA_DEG = stars.RA_DEG
 DEC_DEG = stars.DEC_DEG
 RApm = stars.RApm
 DECpm = stars.DECpm
 Mag = stars.MAG
 ID_1 = stars.TYCHO_ID_1
 ID_2 = stars.TYCHO_ID_2
 byteorder, RA_DEG, /XDRTOF
 byteorder, DEC_DEG, /XDRTOF
 byteorder, RApm, /XDRTOF
 byteorder, DECpm, /XDRTOF
 byteorder, Mag, /XDRTOF
 byteorder, ID_1, /NTOHS
 byteorder, ID_2, /NTOHS

 <span class="comments">;------------------------------------------------------------------</span>
 <span class="comments">; If limits are defined, remove stars which fall outside the limits</span>
 <span class="comments">; Limits in deg, Assumes RA's + DEC's in J2000 (B1950 if /b1950)</span>
 <span class="comments">;------------------------------------------------------------------</span>
<span class="comments">; *** need to use strcat_radec_regions (see strcat_tycho2_input) ***</span>
 if(keyword__set(dec1) and keyword__set(dec2)) then $
   begin
    subs = where(DEC_DEG ge dec1 and DEC_DEG le dec2, count)
    if(count eq 0) then return, ''
    RA_DEG = RA_DEG[subs]
    DEC_DEG = DEC_DEG[subs]
    RApm = RApm[subs]
    DECpm = DECpm[subs]
    Mag = Mag[subs]
    ID_1 = ID_1[subs]
    ID_2 = ID_2[subs]
   end

 if(keyword__set(ra1) and keyword__set(ra2)) then $
   begin
    if(ra1 lt ra2) then begin
      <span class="comments">; 0 R.A. not in the region</span>
      subs = where(RA_DEG ge ra1 and RA_DEG le ra2, count)      
      <span class="comments">; Outside R.A. limits</span>
    endif else begin
      <span class="comments">; 0 R.A. is in the region</span>
      subs = where(RA_DEG ge ra1 or RA_DEG le ra2, count)
      <span class="comments">; Outside R.A. limits</span>
    endelse
    if(count eq 0) then return, ''
    RA_DEG = RA_DEG[subs]
    DEC_DEG = DEC_DEG[subs]
    RApm = RApm[subs]
    DECpm = DECpm[subs]
    Mag = Mag[subs]
    ID_1 = ID_1[subs]
    ID_2 = ID_2[subs]
   end

 RA = RA_DEG*!DPI/180d0
 DEC = DEC_DEG*!DPI/180d0
 tycho_id = STRING(ID_1+100000)
 tycho_id = strmid(strtrim(tycho_id,2),1,5)
 Name = 'TYC ' + tycho_region + '-' + tycho_id + '-' + strtrim(ID_2,2)

 <span class="comments">;-------------------------------------</span>
 <span class="comments">; select named stars</span>
 <span class="comments">;-------------------------------------</span>
 if(keyword__set(names)) then $
  begin
   w = where(names EQ name)
   if(w[0] NE -1) then _stars = stars[w]
   if(NOT keyword__set(_stars)) then return, ''
   stars = _stars
  end

 <span class="comments">;----------------------</span>
 <span class="comments">; Fill star descriptors</span>
 <span class="comments">;----------------------</span>
 n = n_elements(Name)
 print, 'Total of ',n,' stars out of ',nstars,' in Tycho/GSC region ', $
	tycho_region
 if(n eq 0) then return, ''

 <span class="comments">;-----------------------------</span>
 <span class="comments">; Calculate "dummy" properties</span>
 <span class="comments">;-----------------------------</span>
 orient = make_array(3,3,n)
 _orient = [ [1d,0d,0d], [0d,1d,0d], [0d,0d,1d] ]
 for j = 0 , n-1 do orient[*,*,j] = _orient
 avel = make_array(1,3,n,value=0d)
 vel = make_array(1,3,n,value=0d)
 time = make_array(n,value=0d)
 radii = make_array(3,n,value=1d)
 lora = make_array(n, value=0d)
 sp = make_array(n, value=0d)

 <span class="comments">;--------------------------------------------------------</span>
 <span class="comments">; Apply proper motion to star </span>
 <span class="comments">; JTIME = years past 2000.0</span>
 <span class="comments">; RApm and DECpm = milliarcseconds per year</span>
 <span class="comments">;--------------------------------------------------------</span>
 RA = RA + ((double(RApm)*JTIME/3.6e6)*!DTOR) / cos(DEC)
 DEC = DEC + (double(DECpm)*JTIME/3.6e6)*!DTOR


 <span class="comments">;-----------------------------------------------------</span>
 <span class="comments">; Calculate position vector, use distance as 10 parsec </span>
 <span class="comments">; to have apparent magnitude = absolute magnitude</span>
 <span class="comments">;-----------------------------------------------------</span>
 dist = 3.085678d+17 <span class="comments">; 10pc in meters</span>
 radec = transpose([transpose([RA]), transpose([DEC]), transpose([dist])])
 pos = transpose(bod_radec_to_body(bod_inertial(), radec))

<span class="comments">; pos = make_array(3,n,value=0d)</span>
<span class="comments">; pos[0,*] = cos(RA)*cos(DEC)*dist</span>
<span class="comments">; pos[1,*] = sin(RA)*cos(DEC)*dist</span>
<span class="comments">; pos[2,*] = sin(DEC)*dist</span>

 <span class="comments">;---------------------------------------------------</span>
 <span class="comments">; compute skyplane velocity from proper motion </span>
 <span class="comments">;---------------------------------------------------</span>
 radec_vel = transpose([transpose([RApm]/86400d/365.25d/3600d*!dpi/180d), $
             transpose([DECpm]/86400d/365.25d/3600d*!dpi/180d), dblarr(1,n)])
 vel = bod_radec_to_body_vel(bod_inertial(), radec, radec_vel)



 <span class="comments">;-----------------------------------------------------</span>
 <span class="comments">; Precess J2000 to B1950 if wanted</span>
 <span class="comments">;-----------------------------------------------------</span>
 if(keyword__set(b1950)) then pos = $
  transpose(b1950_to_j2000(transpose(pos),/reverse))
 pos = reform(pos,1,3,n)

 if(keyword_set(b1950)) then vel = $
  transpose(b1950_to_j2000(transpose(vel),/reverse))
 vel = reform(vel,1,3,n)

 <span class="comments">;-------------------------------------------------------</span>
 <span class="comments">; Calculate "luminosity" from visual Magnitude</span>
 <span class="comments">; Use Sun as model, though this is wrong for other stars</span>
 <span class="comments">; but since we don't know A (space absorption) and may</span>
 <span class="comments">; only sometimes know Spectral type... what the heck</span>
 <span class="comments">; use formula Mv = 4.83 - 2.5*log(L/Lsun) and since</span>
 <span class="comments">; distance is 10pc mv = Mv</span>
 <span class="comments">;-------------------------------------------------------</span>
 Lsun = const_get('Lsun')
 lum = Lsun * 10.d^( (4.83d0-double(Mag))/2.5d ) 

 _sd = str_create_descriptors( n, $
        name=name, $
        orient=orient, $
        avel=avel, $
        pos=pos, $
        vel=vel, $
        time=time, $
        radii=radii, $
        lora=lora, $
        lum=lum, $
        sp=sp )

 return, _sd
end
<span class="comments">;===============================================================================</span>




<span class="comments">;===============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; :Private:</span>
<span class="comments">; :Hidden:</span>
<span class="comments">;-</span>
<span class="comments">;===============================================================================</span>
<a id="_strcat_tycho_input:source"></a>function _strcat_tycho_input, dd, keyword, n_obj=n_obj, dim=dim, status=status, $
@nv_trs_keywords_include.pro
@nv_trs_keywords1_include.pro
	end_keywords


 return, strcat_input('tycho', dd, keyword, n_obj=n_obj, dim=dim, status=status, $
@nv_trs_keywords_include.pro
@nv_trs_keywords1_include.pro
	end_keywords )

end
<span class="comments">;===============================================================================</span>




<span class="comments">;===============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; :Private:</span>
<span class="comments">; :Hidden:</span>
<span class="comments">;-</span>
<span class="comments">;===============================================================================</span>
<a id="strcat_tycho_input:source"></a>function strcat_tycho_input, dd, keyword, n_obj=n_obj, dim=dim, values=values, status=status, $
@nv_trs_keywords_include.pro
@nv_trs_keywords1_include.pro
	end_keywords


 status = -1
 if(keyword NE 'STR_DESCRIPTORS') then return, ''

 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; get inputs</span>
 <span class="comments">;-----------------------------------------------</span>
 strcat_get_inputs, dd, 'NV_TYCHO_DATA', 'path_tycho', $
	b1950=b1950, j2000=j2000, jtime=jtime, $
	path=path_tycho, names=names, $
	ra1=ra1, ra2=ra2, dec1=dec1, dec2=dec2, $
	faint=faint, bright=bright, $
@nv_trs_keywords_include.pro
@nv_trs_keywords1_include.pro
	end_keywords
  if(NOT keyword__set(path_tycho)) then return, ''
 

 status=0
 n_obj=0
 dim = [1]

 <span class="comments">;---------------------------</span>
 <span class="comments">; Get GSC regions to read in</span>
 <span class="comments">;---------------------------</span>
 ra1 = ra1*180d/!dpi
 ra2 = ra2*180d/!dpi
 dec1 = dec1*180d/!dpi
 dec2 = dec2*180d/!dpi

 regions = tycho_get_regions(ra1, ra2, dec1, dec2, path_tycho=path_tycho)
 nregions = n_elements(regions)
 if(nregions eq 1 AND regions[0] eq '') then $
                                nv_message, 'No Tycho/GSC regions found.'
 nv_message, verb=0.2, 'Number of Tycho/GSC regions found: ', nregions

 <span class="comments">;--------------------------</span>
 <span class="comments">; Loop on Tycho/GSC regions</span>
 <span class="comments">;--------------------------</span>
 first = 1
 for i=0,nregions-1 do $
  begin
   _sd = tycho_get_stars(regions[i], cam_vel=cam__vel, jtime=jtime, $
		ra1=ra1, ra2=ra2, dec1=dec1, dec2=dec2, b1950=b1950, $
		faint=faint, bright=bright, names=names)
   if(keyword__set(_sd)) then $
    begin
      if(first eq 1) then $
        begin
         sd = _sd
         first = 0
        end $
       else sd = [sd, _sd]
    end
  end

 n_obj = n_elements(sd)
print, 'Total Tycho-2 stars found: ',n_obj

 status = -1
 if(n_obj EQ 0) then return, ''

 status = 0
 return, sd
end
<span class="comments">;===============================================================================</span>
</code>
    </div>
  </body>
</html>