<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 20:36:25 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>pdspar.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="pdspar.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;----------------------------------------------------------------------------------------</span>
<span class="comments">; NAME:</span>
<span class="comments">;	PDSPAR</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Obtain the value of a parameter in a PDS header</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	result = PDSPAR( lbl, name,[ abort, MVAL=, COUNT=, INDEX =])</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	Lbl =  PDS header array, (e.g. as returned by SXHREAD or READPDS)</span>
<span class="comments">;		string array, each element should have a length of 80</span>
<span class="comments">;		characters</span>
<span class="comments">;	Name = String name of the parameter to return.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;	ABORT - string specifying that PDSPAR should do a RETALL</span>
<span class="comments">;		if a parameter is not found.  ABORT should contain</span>
<span class="comments">;		a string to be printed if the keyword parameter is not found.</span>
<span class="comments">;		If not supplied PDSPAR will return with a negative</span>
<span class="comments">;		!err if a keyword is not found.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;	result = value of parameter in header. If parameter is double</span>
<span class="comments">;		precision, float, long or string, the result is of that type.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;	COUNT - Optional keyword to return a value equal to the number of</span>
<span class="comments">;		parameters found by PDSPAR, integer scalar</span>
<span class="comments">;	MVAL - 	Optional keyword to return the value of requested keyword</span>
<span class="comments">;		that exceeds the normal allowable string size that can be</span>
<span class="comments">;		printed by the PRINT function. The 'zeroth' record of MVAL-</span>
<span class="comments">;		MVAL(*,0) contains the number of following records that</span>
<span class="comments">;		contain meaningful information.</span>
<span class="comments">;</span>
<span class="comments">;	INDEX - Optional keyword to return an array of the line numbers</span>
<span class="comments">;		where the values being returned were found in the PDS label.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;	Keyword COUNT returns the number of parameters found.</span>
<span class="comments">;	!err is set to -1 if parameter not found, 0 for a scalar</span>
<span class="comments">;	value returned.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;	Given a PDS header, h, return the values of the axis dimension</span>
<span class="comments">;	values. Then return the number of sample bits per pixel.</span>
<span class="comments">;</span>
<span class="comments">;	IDL> x_axis = pdspar( h ,' LINES')         ; Extract Xaxis value</span>
<span class="comments">;	IDL> y_axis = pdspar( h ,' LINE_SAMPLES')  ; Extract Yaxis value</span>
<span class="comments">;	IDL> bitpix = pdspar( h ,' SAMPLE_BITS')   ; Extract bits/pixel value</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;	Each element of lbl is searched for a '=' and the part of each</span>
<span class="comments">;	that preceeds the '=' is saved in the variable 'keyword', with</span>
<span class="comments">;	any line that contains no '=' also saved in keyword. 'keyword'</span>
<span class="comments">;	is then searched for elements that exactly match Name, if none</span>
<span class="comments">;	are found then 'keyword' is searched for elements that contain Name.</span>
<span class="comments">;	If either search succeeds then the characters that follow the '='</span>
<span class="comments">;	in the matching lines are returned.</span>
<span class="comments">;</span>
<span class="comments">;	An error occurs if both above searches fail.</span>
<span class="comments">;</span>
<span class="comments">;	The values returned are converted to numeric value, if possible,</span>
<span class="comments">;	by the STR2NUM function.</span>
<span class="comments">;</span>
<span class="comments">; NOTE:</span>
<span class="comments">;</span>
<span class="comments">;	PDSPAR requires that the label being searched has records of</span>
<span class="comments">;	standard 80 byte length (or 81 bytes for UNIX stream files).</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	Adapted by John D. Koch from SXPAR by DMS, July, 1994</span>
<span class="comments">;</span>
<span class="comments">;    12 May 2003, P. Khetarpal    Fixed the conversion of 10b into</span>
<span class="comments">;                                 string for search in lines 126 and 129.</span>
<span class="comments">;    13 Feb 2006  A. Cardesin     Modified to search for '=' (instead of ' = ')</span>
<span class="comments">;                                 (lines 106 and 133)</span>
<span class="comments">;    06 Aug 2008  P. Choganwala   Fixed "=" sign problem in Description field.</span>
<span class="comments">;    05 Jul 2008  P. Choganwala   Fixed to return multiple lines (Spanned</span>
<span class="comments">;                                 across more then one line) correctly in</span>
<span class="comments">;                                 case they are surrounded with '',{},().</span>
<span class="comments">;----------------------------------------------------------------------</span>

<span class="comments">;Added for 06 Aug 2008 Fix</span>
<a id="get_matching_char:source"></a>function get_matching_char, ipchar
	CASE ipchar OF
	     '"': return,'"'
	     '(': return,')'
	     '{': return,'}'
	     '[': return,']'
	    ELSE: return,'"'
	ENDCASE
end

<a id="PDSPAR:source"></a>function PDSPAR, lbl, name, abort, MVAL=mvalue, COUNT=matches, INDEX = nfound

 params = N_params()
 if params LT 2 then begin
    print,'Syntax - result = pdspar(lbl,name [,abort,MVAL=,COUNT=,INDEX= ])'
    return, -1
 endif

 value = 0
 
 if params LE 2 then begin
    abort_return = 0
    abort = 'PDS Label'
 endif else begin
    abort_return = 1
 endelse
 
<span class="comments">; if abort_return then On_error,1 else On_error,2</span>

<span class="comments">;Check for valid header</span>

 s = size(lbl)		<span class="comments">;Check header for proper attributes.</span>
 if (s[0] NE 1) or (s[2] NE 7) then begin
    message,abort+' (first parameter) must be a string array'
 endif

<span class="comments">;Copy name, make upper case  ;line100</span>

 nam = strtrim(strupcase(name),2)

<span class="comments">;Loop on lines of the header</span>

<span class="comments">;Modified A.Cardesin 2006Feb13: changed ' = ' into '='</span>
 
 key_end = strpos(lbl,'=')			<span class="comments">;find '=' in all lines of lbl</span>
 r = size(key_end)
 stopper = r[r[r[0]-1]]
 keyword = strarr(stopper)
 for j = 0,stopper-1 do begin
     if key_end[j] LT 0 then keyword[j] = '*' $
     else keyword[j]=strtrim(strmid(lbl[j],0,key_end[j]),2)
 endfor

<span class="comments">;Added for 05 Jul 2008 Fix</span>
 nfound = where(keyword EQ "DESCRIPTION", matches)
 srch = '"'
 if matches GT 0 then begin
  for j = 0, matches - 1 do begin
    res1 = STRPOS(lbl[nfound[j]],srch)
    res2 = STRPOS(lbl[nfound[j]],srch,res1+1)
    if (res2 EQ -1) then begin
       start=nfound[j]+1
       while (STRPOS(lbl[start],srch) EQ -1) do begin
            keyword[start] = '*'
            start += 1
       endwhile
       keyword[start] = '*'
    endif
  endfor
 endif

 nfound = where(keyword EQ nam, matches) <span class="comments">; index where the keyword matches nam</span>
 
 if matches EQ 0 then begin
    nfound = where(strpos(keyword,nam) GT -1,matches)
 endif

<span class="comments">; Process string parameter and use STR2NUM to obtain numeric value</span>

 if matches GT 0 then begin
    line = lbl[nfound]
    nfd = size(nfound)
    quitter = nfd[nfd[nfd[0]-1]]
    svalue = strarr(quitter)
    mvalue = strarr(quitter,100)
    value = svalue
    i = 0
    while i LT quitter do begin
          n = nfound[i]
          knd = key_end[n]
          retrn = strpos(line[i],string(10b))
          if retrn EQ -1 then retrn = 80

<span class="comments">;Modified A.Cardesin 2006Feb13: knd+1 (for '=') instead of knd+2 (for ' = ')</span>

          svalue[i] = strtrim(strmid(line[i],knd+1,retrn-knd-2),2)
          spot = strpos(svalue[i],string(10b))
          if spot GT 0 then svalue[i]=strtrim(strmid(svalue[i],0,spot-1),2)
      
          check = stregex(svalue[i],'["([{]')

          if check GT -1 then begin

	     char_start = stregex(svalue[i],'["([{]',/extract)
	     char_end = get_matching_char(char_start)

             k = n
      	     c=strpos(svalue[i],char_end,check+1)
             if c GT -1  then value[i]=strtrim(svalue[i],2) else begin
	        for a = 0, key_end[n]+1 do value[i]=value[i]+' '
	        value[i] = value[i] + svalue[i]
	     endelse
	     m = 0
	     m2 = 0
             while c LT 0 do begin
                   k = k+1
	           m = m+1
	           m2=fix(m/24)
                   if m2 EQ 0 then value[i]=value[i] + ' ' + strtrim(lbl[k],2) $
 	           else if m2 GT 0 then mvalue[i,m2]=mvalue[i,m2]+' '+strtrim(lbl[k],2) $
	           else print,'Illegal value of variable m2 ='+m2
	           c = strpos(lbl[k],char_end)
<span class="comments">;	           if (c GT -1) then if(keyword[k+1] EQ '*') then c = -1</span>
             endwhile
             mvalue[i,0]=fix(m2[0])

          endif else begin
	     value[i]=str2num(strtrim(svalue[i],2))
          endelse
	i = i + 1
    endwhile
    
 endif  else begin
   if abort_return then message,'Keyword '+nam+' not found in '+abort <span class="comments">;150</span>
   !ERR = -1
 endelse

<span class="comments">;	To print value and mvalue after running pdspar use:</span>
<span class="comments">;           print,value(*)</span>
<span class="comments">;           for d = 1,mvalue(*,0) do print,mvalue(*,d)</span>
<span class="comments">;	where '*' is any number valid for value(*)</span>
 
 return,value

end
</code>
    </div>
  </body>
</html>