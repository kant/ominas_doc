<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 13:33:19 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>pointpds.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="pointpds.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;------------------------------------------------------------------------------</span>
<span class="comments">; NAME: POINTPDS</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE: To process the pointer to an object in a PDS file</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE: Result = POINTPDS (label, filename, objectname)</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;    Label: String array containing the PDS header</span>
<span class="comments">;    Filename: Scalar string containing the name of the PDS file to read</span>
<span class="comments">;    objectname: The name of the object to process pointer information for</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;    Result: a structure containing the name of the datafile and the skip</span>
<span class="comments">;            offset in bytes</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT: none</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;    To obtain information from TABLE.LBL on a TABLE object:</span>
<span class="comments">;       IDL> label = HEADPDS ("TABLE.LBL",/SILENT)</span>
<span class="comments">;       IDL> pointer = POINTPDS (label, "TABLE.LBL","TABLE")</span>
<span class="comments">;       IDL> help, /STRUCTURE, pointer</span>
<span class="comments">;            FLAG                      1</span>
<span class="comments">;            DATAFILE         "TABLE.TAB"</span>
<span class="comments">;            SKIP                   2056</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;    Functions: PDSPAR, CLEAN, STR2NUM</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;    Code to look for both uppercase and lowercase</span>
<span class="comments">;    datafile name. Parin Choganwala, April 2008</span>
<span class="comments">;</span>
<span class="comments">;    Code to look into "label" directory for</span>
<span class="comments">;    formate file(.FMT). Parin Choganwala, April 2008</span>
<span class="comments">;</span>
<span class="comments">;    Written by: Puneet Khetarpal [August, 2002]</span>
<span class="comments">;    For a complete list of modifications, see changelog.txt file.</span>
<span class="comments">;    Modified: P.Choganwala 2008Apr: Enhanced the pointpds to look into </span>
<span class="comments">;                                    label directory for .fmt files</span>
<span class="comments">;    Modified: A.Cardesin 2006Jan: Check RECORD_BYTES only if needed</span>
<span class="comments">;              A.Cardesin 2005May: Corrected path separator for windows</span>
<span class="comments">;------------------------------------------------------------------------------</span>

<a id="pointpds:source"></a>function pointpds, label, fname, objname
    <span class="comments">; error protection:</span>
    <span class="comments">;on_error, 2</span>

    <span class="comments">; initialize structure:</span>
    pointer = create_struct("flag", 1)    

<span class="comments">;Modified A.Cardesin 2006Jan: check RECORD_BYTES only if needed (further down)</span>
<span class="comments">;    ; obtain record bytes keyword value:</span>
<span class="comments">;    record_bytes = pdspar (label, "RECORD_BYTES", COUNT=recbytescount)</span>
<span class="comments">;    if (recbytescount eq 0) then begin</span>
<span class="comments">;        print, "Error: missing required RECORD_BYTES keyword."</span>
<span class="comments">;        goto, endfun</span>
<span class="comments">;    endif</span>

    <span class="comments">; obtain pointer to objname:</span>
    param = "^" + objname
    point = PDSPAR (label, param, COUNT=pointercount)
    if (pointercount eq 0) then begin
        print, "Error: pointer to " + objname + " object missing."
        goto, endfun
    endif

    <span class="comments">; clean and save pointer as backup:</span>
    point = clean(point[0], /space)
    savepoint = point

    <span class="comments">; remove parentheses from string:</span>
    rightp = strpos(point, "(" )
    leftp = strpos(point, ")" )
    if (rightp gt -1 && leftp gt -1) then begin
        rightp += 1
        length = leftp - rightp
        point = strmid(point, rightp, length)
    endif

    <span class="comments">; check for &lt;BYTES> flag and remove it if found:</span>
    rightp = strpos (point, "&lt;BYTES>")
    if (rightp gt -1) then begin
        byte_offset_flag = 1
        point = strmid(point, 0, rightp)
    endif else begin
        byte_offset_flag = 0
    endelse

    <span class="comments">; check for double quotes and extract:</span>
    rightp = strpos (point, '"')
    if (rightp gt -1) then begin
        leftp = strpos (point,'"', rightp + 1)
    endif else begin
        leftp = -1
    endelse

    <span class="comments">; if there was a filename, save it:</span>
    datafile = ""
    if (rightp gt -1 && leftp gt -1) then begin
        rightp += 1
        length = leftp - rightp
        datafile = strmid (point, rightp, length)

        <span class="comments">; remove the file name from the pointer string:</span>
        length = strlen(point) - leftp
        point = strmid (point, leftp + 1, length)
    endif else if (rightp eq -1 xor leftp eq -1) then begin
        print, "Error: badly formatted file pointer " + savepoint
        goto, endfun
    endif
 
    <span class="comments">; obtain bytes_offset or skip bytes:</span>
    rightp = strpos (point, ",")
    if (rightp gt -1) then begin
        rightp += 1
        length = strlen(point)
        point = strmid (point, rightp, length - rightp)
    endif   
    skip = (strlen(point) eq 0) ? 0 : long(str2num(point))

    <span class="comments">; assign the skip bytes for byte offset flag:</span>
    if (~byte_offset_flag && skip ne 0) then begin
<span class="comments">;Modified A.Cardesin 2006Jan: check RECORD_BYTES only if needed; ; ; ; ; ; ;</span>
    	<span class="comments">; obtain record bytes keyword value:                               ;</span>
    	record_bytes = pdspar (label, "RECORD_BYTES", COUNT=recbytescount) <span class="comments">;</span>
    	if (recbytescount eq 0) then begin                                 <span class="comments">;</span>
           print, "Error: missing required RECORD_BYTES keyword."          <span class="comments">;</span>
           goto, endfun                                                    <span class="comments">;</span>
    	endif                                                              <span class="comments">;</span>
        skip = (skip - 1) * record_bytes[0]
    endif else if (byte_offset_flag && skip ne 0) then begin
        skip -= 1
    endif
    
    if (strupcase(!version.os_name) EQ 'MICROSOFT WINDOWS')then begin
          sep="\\"
          lbl_dir='label\'
    endif else begin
          sep=PATH_SEP()
          lbl_dir='label'+sep
    endelse

    <span class="comments">; if there is a datafile, then check:</span>
    if (strlen(datafile) gt 0) then begin
       <span class="comments">;Modified A.Cardesin 23 May 2005</span>
       <span class="comments">;corrected for Windows, using File_Dirname       </span>
        dir = FILE_DIRNAME(fname,/MARK_DIRECTORY)

<span class="comments">;Modification - JAN 2011 - BPrager</span>
	<span class="comments">; Changed this section to consolidate all the small fixes into one logical segment of code.</span>
   <span class="comments">; Now the script will check a camel case path (i.e. The path entered by the user explicitely)</span>
   <span class="comments">; and then check for the file in six different ways. Either the file is uppercase or lowercase</span>
   <span class="comments">; and exists in the current folder, is uppercase or lowercase and in a folder 'LABEL/', or in a</span>
   <span class="comments">; folder 'label/'. The script will go back along the path entered by the user to search for the</span>
   <span class="comments">; file.</span>
   err      = -1                             <span class="comments">; Error flag for trying to open a given file</span>
   flag     = 0                              <span class="comments">; Flag to determine if the code should keep looking for the file</span>
   idflag   = 0                              <span class="comments">; Flag to determine if the file was found or not</span>
   CAMpath  = dir                            <span class="comments">; A duplicate of the original path that will be edited as we look through the path</span>
   dirlist  = strsplit(dir,'/',/extract)     <span class="comments">; An array with folder names in path</span>

   if strmid(dir,0,1) EQ '/' then begin
      lead = '/'
   endif else begin
      lead = ''
   endelse 

   while flag eq 0 do begin
      CAM_lc      = CAMpath + strlowcase(datafile)                <span class="comments">; Path for lowercase version of file in current folder</span>
      CAM_uc      = CAMpath + strupcase(datafile)                 <span class="comments">; Path for uppercase version of file in current folder</span>
      CAM_lc_labu = CAMpath + 'LABEL/' + strlowcase(datafile)     <span class="comments">; Path for lowercase version of file in current folder + 'LABEL/'</span>
      CAM_uc_labu = CAMpath + 'LABEL/' + strupcase(datafile)      <span class="comments">; Path for uppercase version of file in current folder + 'LABEL/'</span>
      CAM_lc_labl = CAMpath + 'label/' + strlowcase(datafile)     <span class="comments">; Path for lowercase version of file in current folder + 'label/'</span>
      CAM_uc_labl = CAMpath + 'label/' + strupcase(datafile)      <span class="comments">; Path for uppercase version of file in current folder + 'label/'</span>

      CAMchk_lc      = FILE_TEST(CAM_lc)
      CAMchk_uc      = FILE_TEST(CAM_uc)
      CAMchk_lc_labu = FILE_TEST(CAM_lc_labu)
      CAMchk_uc_labu = FILE_TEST(CAM_uc_labu)
      CAMchk_lc_labl = FILE_TEST(CAM_lc_labl)
      CAMchk_uc_labl = FILE_TEST(CAM_uc_labl)

      if (CAMchk_lc EQ 1) then begin
		   openr,unit, CAM_lc, error = err, /get_lun
		   fname = CAM_lc
         flag = 1
	   endif
      if (CAMchk_uc EQ 1) then begin
		   openr,unit, CAM_uc, error = err, /get_lun
		   fname = CAM_uc
         flag = 1
	   endif
      if (CAMchk_lc_labu EQ 1) then begin
		   openr,unit, CAM_lc_labu, error = err, /get_lun
		   fname = CAM_lc_labu
         flag = 1
	   endif
      if (CAMchk_uc_labu EQ 1) then begin
		   openr,unit, CAM_uc_labu, error = err, /get_lun
		   fname = CAM_uc_labu
         flag = 1
	   endif
      if (CAMchk_lc_labl EQ 1) then begin
		   openr,unit, CAM_lc_labl, error = err, /get_lun
		   fname = CAM_lc_labl
         flag = 1
	   endif
      if (CAMchk_uc_labl EQ 1) then begin
		   openr,unit, CAM_uc_labl, error = err, /get_lun
		   fname = CAM_uc_labl
         flag = 1
	   endif

      if flag eq 0 then begin
         CAMpath = lead

         if n_elements(dirlist) eq 1 then begin
            flag     = 1
            idflag   = 1
         endif else begin
            dirlist = dirlist[0:n_elements(dirlist)-2]            <span class="comments">; Pop off final element from the array for next iteration</span>

            for path_idx=0,n_elements(dirlist)-1,1 do begin
               CAMpath = CAMpath + dirlist[path_idx] + '/'        <span class="comments">; Re-write CAMpath as if the path were promoted by one folder</span>
            endfor
         endelse
      endif
   endwhile


	if (idflag eq 1 and err NE 0) then begin
		message, "Error: Could Not open data file. If possible, move this file to your local directory and try again. It is located under the label directory in the parent data file. The data file that could not be opened:" +dir+datafile
		pointer.flag=-1
		return, pointer
	endif 


    endif else begin
        openr, unit, fname, error = err, /get_lun
        if (err ne 0) then begin
            print, "Error: could not re-open " + fname
            goto, endfun
        endif
    endelse

    close, unit
    free_lun, unit

    <span class="comments">; store pointer information in a structure:</span>
    pointer = create_struct (pointer, "datafile", fname, "skip", skip)      

    return, pointer

    endfun:
        pointer.flag = -1
        return, pointer
end
</code>
    </div>
  </body>
</html>