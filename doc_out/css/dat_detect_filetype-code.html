<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Thu Aug 18 11:37:49 2016 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dat_detect_filetype.pro (OMINAS API Documentation)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dat_detect_filetype.pro (OMINAS API Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;=============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	dat_detect_filetype</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Attempts to detect the type of the given file by calling the </span>
<span class="comments">;	detectors in the filetype detectors table.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;	NV/SYS</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	filetype = dat_detect_filetype(filename)</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; ARGUMENTS:</span>
<span class="comments">;  INPUT:</span>
<span class="comments">;	filename:	Name of file to test.</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;  INPUT: </span>
<span class="comments">;	silent:	If set, messages will be suppressed.</span>
<span class="comments">;</span>
<span class="comments">;	default:	If set, the 'default' filetype is returned.</span>
<span class="comments">;			The default filetype is the first item in the table</span>
<span class="comments">;			whose action is not 'IGNORE'.</span>
<span class="comments">;</span>
<span class="comments">;	all:	If set, all filetypes in the table are returned.</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; RETURN: </span>
<span class="comments">;	String giving the filetype, or null string if none detected.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; STATUS:</span>
<span class="comments">;	Complete</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">; 	Written by:	Spitale</span>
<span class="comments">;	</span>
<span class="comments">;-</span>
<span class="comments">;=============================================================================</span>
<a id="dat_detect_filetype:source"></a>function dat_detect_filetype, filename, silent=silent, default=default, all=all, action=action
@nv_block.common
@core.include


 <span class="comments">;=====================================================</span>
 <span class="comments">; read the filetype table if it doesn't exist</span>
 <span class="comments">;=====================================================</span>
 if(NOT keyword_set(*nv_state.ftp_table_p)) then $
   dat_read_config, 'NV_FTP_DETECT', $
              nv_state.ftp_table_p, nv_state.ftp_detectors_filenames_p
 table = *nv_state.ftp_table_p
 actions = strupcase(table[*,2])

 <span class="comments">;=====================================================</span>
 <span class="comments">; default type is the first entry that is not ignored</span>
 <span class="comments">;=====================================================</span>
 if(keyword_set(default)) then $
  begin
   w = where(actions NE 'IGNORE')
   if(w[0] EQ -1) then return, ''
   return, table[w[0],1] 
  end


 <span class="comments">;=====================================================</span>
 <span class="comments">; /all means just return all filetypes</span>
 <span class="comments">;=====================================================</span>
 if(keyword_set(all)) then return, table[*,1] 


 <span class="comments">;=====================================================</span>
 <span class="comments">; call filetype detectors until true is returned</span>
 <span class="comments">;=====================================================</span>
 s = size(table)
 n_ftp = s[1]
 for i=0, n_ftp-1 do $
  begin
   detect_fn = table[i,0]
   if(call_function(detect_fn, filename)) then $
    begin
     filetype = table[i,1]
     action = actions[i]
     return, filetype
    end
  end


 return, ''
end
<span class="comments">;===========================================================================</span>
</code>
    </div>
  </body>
</html>