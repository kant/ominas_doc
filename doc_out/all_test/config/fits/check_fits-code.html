<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 11:09:51 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>check_fits.pro (OMINAS API Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="check_fits.pro (OMINAS API Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;=============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	check_fits</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Given a FITS array IM, and a associated FITS or STSDAS header HDR, this</span>
<span class="comments">;	procedure will check that</span>
<span class="comments">;		(1) HDR is a string array, and IM is defined and numeric   </span>
<span class="comments">;		(2) The NAXISi values in HDR are appropiate to the dimensions </span>
<span class="comments">;                   of IM</span>
<span class="comments">;		(3) The BITPIX value in HDR is appropiate to the datatype of IM</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;	UTIL/FITS</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	check_fits, im, hdr, [ dimen, idltype, /UPDATE, /NOTYPE, /SDAS ]</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; ARGUMENTS:</span>
<span class="comments">;  INPUT:</span>
<span class="comments">;	im:	FITS or  STSDAS array, (e.g. as read by SXREAD or READFITS ).</span>
<span class="comments">;</span>
<span class="comments">;	hdr:	FITS or  STSDAS header (string array) associated with im.</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT:</span>
<span class="comments">;	dimen:		Vector containing actual array dimensions</span>
<span class="comments">;</span>
<span class="comments">;	idltype:	Data type of the FITS array as specified in the IDL SIZE</span>
<span class="comments">;			function (1 for BYTE, 2 for INTEGER*2, 3 for INTEGER*4,</span>
<span class="comments">;			etc.)</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;  INPUT:</span>
<span class="comments">;	NOTYPE:	If this keyword is set, then only agreement of the array</span>
<span class="comments">;		dimensions with the FITS header are checked, and not the </span>
<span class="comments">;		data type.</span>
<span class="comments">;</span>
<span class="comments">;	UPDATE:	If this keyword is set then the BITPIX, NAXIS and DATATYPE</span>
<span class="comments">;		FITS keywords will be updated to agree with the array.</span>
<span class="comments">;</span>
<span class="comments">;	SDAS:	If this keyword is set then the header is assumed to be from</span>
<span class="comments">;		an SDAS (.hhh) file.    CHECK_FITS will then ensure that (1)</span>
<span class="comments">;		a DATATYPE keyword is included in the header and (2) BITPIX</span>
<span class="comments">;		is always written with positive values.</span>
<span class="comments">;</span>
<span class="comments">;	FITS:	If this keyword is present then CHECK_FITS assumes that it is</span>
<span class="comments">;		dealing with a FITS header and not an SDAS header, see notes</span>
<span class="comments">;		below.</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; RETURN: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;	If there is a fatal problem with the FITS array or header then !ERR is</span>
<span class="comments">;	set to -1.   ( If the UPDATE keyword was supplied, and the header could</span>
<span class="comments">;	be fixed then !ERR = 0.)</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;	An important distinction between an STSDAS header and a FITS header</span>
<span class="comments">;	is that the BITPIX value in an STSDAS is always positive, e.g. BITPIX=32</span>
<span class="comments">;	for REAL*4 data.    Users should use either the /SDAS or the /FITS </span>
<span class="comments">;	keyword if it is important whether the STSDAS or FITS convention for </span>
<span class="comments">;	REAL*4 data is used.  Otherwise, CHECK_FITS assumes that if a </span>
<span class="comments">;	DATATYPE keyword is present then it is dealing with an STSDAS header.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;	Program checks the NAXIS1 and NAXIS2 parameters in the header to</span>
<span class="comments">;	see if they match the image array dimensions.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; STATUS:</span>
<span class="comments">;	Complete</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	Written, December 1991  W. Landsman Hughes/STX to replace CHKIMHD</span>
<span class="comments">;	No error returned if NAXIS=0 and IM is a scalar   W. Landsman  Feb 93</span>
<span class="comments">;	Fixed bug for REAL*8 STSDAS data W. Landsman July 93</span>
<span class="comments">;	Make sure NAXIS agrees with NAXISi  W. Landsman  October 93</span>
<span class="comments">;	</span>
<span class="comments">;-</span>
<span class="comments">;=============================================================================</span>
<a id="check_FITS:source"></a>pro check_FITS, im, hdr, dimen, idltype, UPDATE = update, NOTYPE = notype, $
                           SDAS = sdas, FITS = fits
 On_error,2

 if N_params() LT 2 then begin
    print,'Syntax - CHECK_FITS, im, hdr, dimen, idltype, '
    print,'                      [ /UPDATE, /NOTYPE, /SDAS, /FITS]
    return
 endif

 hinfo = size(hdr)

 if ( hinfo(0) NE 1 ) then begin	              <span class="comments">;Is hd of string type?</span>
	message,'ERROR - FITS header must be a string array', /CON
        !ERR = -1 & return
 endif

 im_info = size(im)
 ndim = im_info(0)

 nax = sxpar( hdr, 'NAXIS' ) 
 if !ERR EQ -1 then $
        message,'ERROR - FITS header missing NAXIS keyword'

 if ( ndim EQ 0 ) then $                  <span class="comments">;Null primary array</span>
     if nax EQ 0 then begin
         !ERR = 0
         return
     endif else begin
         !ERR = -1
         message,'ERROR - FITS array is not defined'
     endelse

 dimen = im_info( indgen( im_info(0) ) + 1)
 ndimen = N_elements( dimen)
 naxis = sxpar( hdr, 'NAXIS*')
 naxi = N_elements( naxis )
 if nax GT naxi then begin                 <span class="comments">;Does NAXIS agree with # of NAXISi?</span>
	if keyword__set( UPDATE) then begin
		sxaddpar, hdr, 'NAXIS', naxi
		message, /CON, 'NAXIS changed from ' + strtrim(nax,2) + $
		' to ' + strtrim(naxi,2)
	endif else begin 
		message,/CON, 'ERROR in FITS header - NAXIS = ' + $
		strtrim(nax,2) + ', but only ' + strtrim(naxi, 2) + $ 
		' axis defined'
		!ERR = -1  &  return
 	endelse
 endif

 last = naxi-1                        <span class="comments">;Remove degenerate dimensions</span>
 while ( (naxis(last) EQ 1) and (last GE 1) ) do last = last -1
 if last NE nax-1 then begin
     naxis = naxis( 0:last)
 endif 

 if ( ndimen NE last + 1 ) then begin
    if not keyword__set( UPDATE) THEN begin
        message, /CON, $
        'ERROR - # of NAXISi keywords does not match # of array dimensions'
        !ERR = -1   & return
     endif else goto, DIMEN_ERROR
 endif

 for i = 0,last do begin
      if naxis(i) NE im_info(i+1) then begin
      if not keyword__set( UPDATE ) then begin
        message, /CON, $
       'ERROR - Invalid NAXIS' + strn( i+1 ) + ' keyword value in header'
        !ERR = -1   & return
      endif else goto, DIMEN_ERROR
    endif
 endfor

DATATYPE: 

 if not keyword__set( NOTYPE ) then begin

   idltype = im_info(im_info(0)+1)
   datatype = strtrim( sxpar( hdr, 'DATATYPE' ))
   if !ERR NE -1 then begin
     case idltype of

     1: if ( datatype NE 'INTEGER*1' ) then goto, DATATYPE_ERROR
     2: if ( datatype NE 'INTEGER*2' ) and  $
           ( datatype NE 'UNSIGNED*2') then goto, DATATYPE_ERROR
     4: if ( datatype NE 'REAL*4' ) then goto, DATATYPE_ERROR
     3: if ( datatype NE 'INTEGER*4') and  $
           ( datatype NE 'UNSIGNED*4') then goto, DATATYPE_ERROR
     5: if ( datatype NE 'REAL*8' ) then goto, DATATYPE_ERROR
     6: if ( datatype NE 'COMPLEX*8' ) then goto, DATATYPE_ERROR
     else: begin
	   message,'Image array is non-numeric datatype',/CON
           !ERR = -1  & return
      end
      endcase
    endif else begin
       if keyword__set(SDAS) then goto, DATATYPE_ERROR
       datatype = ''
    endelse
 
BITPIX:    
  bitpix = sxpar( hdr, 'BITPIX')

    case idltype of

     1: if ( bitpix NE 8) then goto, BITPIX_ERROR
     2: if ( bitpix NE 16 ) then goto, BITPIX_ERROR  
     4: begin
        if keyword__set(FITS) and (bitpix NE -32) then goto, BITPIX_ERROR $
        else begin
        if ( abs( bitpix) NE 32 ) then goto, BITPIX_ERROR
        if bitpix EQ 32 then if datatype NE 'REAL*4' then goto, BITPIX_ERROR
        endelse
        end
     3: if bitpix NE 32 then goto, BITPIX_ERROR 
     5: begin
        if keyword__set(FITS) and (bitpix NE -64) then goto, BITPIX_ERROR $
        else begin
        if ( abs( bitpix) NE 64 ) then goto, BITPIX_ERROR
        if bitpix EQ 64 then if datatype NE 'REAL*8' then goto, BITPIX_ERROR
        endelse
        end
     else: begin
	   if not ( (idltype EQ 6) and (datatype EQ 'COMPLEX*8') ) then  $
              message,'Data array is a non-numeric datatype',/CON
           !ERR = -1  & return
      end

   endcase

 endif

 !ERR = 0
 return

DATATYPE_ERROR:
    if  keyword__set( UPDATE ) then begin

       dtype = ['', 'INTEGER*1', 'INTEGER*2', 'INTEGER*4', 'REAL*4', $
                       'REAL*8',  'COMPLEX*16' ]
       datatype = dtype( idltype)
     message,'DATATYPE keyword of '+ datatype + ' added to FITS header',/INF
     sxaddpar, hdr, 'DATATYPE', datatype, $
                     ' FITS/SDAS version of BITPIX', 'HISTORY'
     goto, BITPIX

   endif else begin
      message, 'ERROR - Incorrect DATATYPE keyword of ' + datatype, /CON
      !ERR = -1 & return
   endelse

BITPIX_ERROR:
    if keyword__set( UPDATE ) then begin
    bpix = [0, 8, 16, 32, -32, -64, 32 ]
    if keyword__set(SDAS) then bpix = abs(bpix)
    comm = ['',' Character or unsigned binary integer', $
               ' 16-bit twos complement binary integer', $
               ' 32-bit twos complement binary integer', $
               ' IEEE single precision floating point', $
               ' IEEE double precision floating point', $
               ' 32-bit twos complement binary integer' ]
    bitpix = bpix(idltype)
    comment = comm(idltype)
    message, 'BITPIX value of ' + strn(bitpix) +  ' added to FITS header', /INF
    sxaddpar, hdr, 'BITPIX', bitpix, comment
    !ERR = 0 & return

  endif else message, 'ERROR - BITPIX value of ' + strn(bitpix) +  $
             ' does not match array'

DIMEN_ERROR:
   if keyword__set( UPDATE ) then begin
	sxaddpar, hdr, 'NAXIS', ndimen, before = 'NAXIS1'
	for i = 1, ndimen do sxaddpar, hdr, 'NAXIS' + strn(i), dimen(i-1), $
		'Number of positions along axis ' + strn(i), $
		after = 'NAXIS' + strn(i-1)          
	if naxi GT ndimen then begin
		for i = ndimen+1, naxi do sxdelpar, hdr, 'NAXIS'+strn(i)
	endif
	message,'NAXIS keywords in FITS header have been updated', /INF
	goto, DATATYPE
   endif

end
</code>
    </div>
  </body>
</html>